"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Server;

var _http = _interopRequireDefault(require("http"));

var _url = _interopRequireDefault(require("url"));

var _path = _interopRequireDefault(require("path"));

var _koa = _interopRequireDefault(require("koa"));

var _koaRouter = _interopRequireDefault(require("koa-router"));

var _koaEtag = _interopRequireDefault(require("koa-etag"));

var _koaConditionalGet = _interopRequireDefault(require("koa-conditional-get"));

var _logger = _interopRequireDefault(require("../lib/logger"));

var _escapeRegExp = _interopRequireDefault(require("../lib/helpers/escapeRegExp"));

var _once = _interopRequireDefault(require("../lib/helpers/once"));

var _pick = _interopRequireDefault(require("../lib/helpers/pick"));

var _fs = require("../lib/helpers/fs");

var _manifest = _interopRequireDefault(require("../lib/manifest"));

var _configStore = _interopRequireDefault(require("../lib/config-store"));

var _urlBuilder = require("../lib/url-builder");

var _context = require("./installer/context");

var _resource = _interopRequireDefault(require("./installer/resource"));

var _installer = _interopRequireDefault(require("./installer"));

var _watcher = _interopRequireDefault(require("./installer/watcher"));

var _timing = _interopRequireDefault(require("./middleware/timing"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

// eslint-disable-next-line no-process-env
const ENV = process.env.BUILD_ENV || process.env.NODE_ENV || process.env.BABEL_ENV;

function getResponseBody(path) {
  return (0, _fs.readFileAsync)(path, null);
}

function generateTag(_ref) {
  let {
    type,
    target
  } = _ref,
      other = _objectWithoutProperties(_ref, ["type", "target"]);

  const attributes = Object.entries(other).map(([key, value]) => value === true ? key : `${key}="${value}"`).join(' ');

  switch (type) {
    case 'css':
      return `<link href="${target}" rel="stylesheet" ${attributes} />`;

    case 'js':
      return `<script src="${target}" ${attributes}></script>`;

    case 'json':
      return `<script type="application/json" ${attributes}>${target}</script>`;

    default:
      return '';
  }
}

function createScopeRouter(C, watcher) {
  const router = new _koaRouter.default();
  const {
    contextFactory,
    outputPath
  } = new _resource.default(C);
  const getModuleMap = (0, _once.default)(() => {
    // eslint-disable-next-line global-require, import/no-dynamic-require
    const {
      modules
    } = require(outputPath);

    if (ENV === 'test') {
      setImmediate(() => {
        delete require.cache[outputPath];
        getModuleMap.clear();
      });
    } else if (C.watch) {
      watcher.once('beforeupdate', () => {
        delete require.cache[outputPath];
        getModuleMap.clear();
      });
    }

    return modules;
  });
  const getAssetMap = (0, _once.default)(() => {
    // eslint-disable-next-line global-require, import/no-dynamic-require
    const {
      assets
    } = require(outputPath);

    if (ENV === 'test') {
      setImmediate(() => {
        delete require.cache[outputPath];
        getAssetMap.clear();
      });
    } else if (C.watch) {
      watcher.once('beforeupdate', () => {
        delete require.cache[outputPath];
        getAssetMap.clear();
      });
    }

    return assets;
  });

  const basePathname = _url.default.parse(C.server.uri).pathname;

  const staticFiles = C.server.static;

  function getManifestJSON(path, opts) {
    // eslint-disable-next-line global-require, import/no-dynamic-require
    const json = require(path)(_objectSpread({
      assetMap: getAssetMap()
    }, opts));

    if (ENV === 'test') {
      delete require.cache[path];
    } else if (C.watch) {
      watcher.once('beforeupdate', () => {
        delete require.cache[path];
      });
    }

    return json;
  }

  function scopeResolver(request, safe) {
    const ctx = contextFactory((request || C.entry).replace(/^:|(:\d+){1,2}$/g, ''));

    if (ctx.error && !safe) {
      throw ctx.error;
    }

    const mappedSlug = getModuleMap()[ctx.slug] || ctx.slug;
    const manifestPath = (0, _context.getManifestPath)((0, _context.slugToAbsolutePath)(C.outputDir, mappedSlug));
    const resolved = (0, _context.slugToAbsolutePath)(C.outputDir, getAssetMap()[mappedSlug] || mappedSlug);
    const sourceMap = (0, _context.slugToAbsolutePath)(C.outputDir, `${ctx.slug}.map`);
    return _objectSpread({}, (0, _pick.default)(ctx, ['error', 'moduleId', 'origin', 'pid']), {
      manifestPath,
      resolved,
      sourceMap
    });
  }

  function getResourceType(resolved) {
    const type = _path.default.extname(resolved).replace(/^\./, '');

    return type === 'css' || type === 'js' ? type : 'raw';
  }

  function getResourcePath(moduleId, query) {
    return (0, _urlBuilder.assembleResourceURL)({
      pathname: basePathname
    }, moduleId, query);
  }

  function renderStaticTags(request, type) {
    const ctx = scopeResolver(request);

    const manifest = _manifest.default.load(getManifestJSON(ctx.manifestPath, {
      dependencyFilter: meta => !type || type === meta.type
    }));

    const tags = manifest.list().reduce((acc, moduleId) => {
      const assetId = manifest.getAssetId(moduleId);

      if (!acc.has(assetId) && assetId !== manifest.meta('assetId')) {
        acc.set(assetId, generateTag({
          target: getResourcePath(assetId),
          type: manifest.getType(moduleId),
          'data-pid': manifest.getPid(moduleId),
          'data-remote-modules': true
        }));
      }

      return acc;
    }, new Map());

    if (!type || type === manifest.meta('type')) {
      tags.set(manifest.meta('assetId'), generateTag({
        type: manifest.meta('type'),
        target: getResourcePath(manifest.meta('assetId')),
        'data-module-id': manifest.meta('moduleId'),
        'data-pid': manifest.meta('pid'),
        'data-main': true,
        'data-remote-modules': true
      }));
    }

    if (!type || type === 'js') {
      tags.set(ctx.manifestPath, generateTag({
        type: 'json',
        target: JSON.stringify(getManifestJSON(ctx.manifestPath, {
          dependencyFilter: meta => meta.type !== 'raw'
        })),
        'data-module-id': manifest.meta('moduleId'),
        'data-pid': manifest.meta('pid'),
        'data-remote-modules': true
      }));
    }

    return [...tags.values()].join('\n');
  } // FOR DEVELOPMENT ONLY!!! REMOVE!!!


  if (ENV !== 'production') {
    router.get('/browser(/)?:request(.*)', async ctx =>
    /* istanbul ignore next */
    {
      const {
        request
      } = ctx.params;
      const {
        moduleId
      } = scopeResolver(request);
      const auto = ctx.query.auto !== 'false';
      const dynamic = Boolean(ctx.query.dynamic);
      ctx.body = `
				<html>
					<head>
						${dynamic ? '' : renderStaticTags(request, 'css')}
					</head>
					<body>
						<script>
							window.IMPORT_SCOPE = '${C.scopeKey}';
							window.IMPORT_REQUEST = '${ctx.query.import || `<${C.scopeKey}>/${(0, _urlBuilder.getResourcePathFromID)(moduleId)}`}';
							console.time('client:import');
						</script>
						${dynamic ? '' : renderStaticTags(request, 'js')}
						<script src="${basePathname}/static/dist/client.browser.js"></script>
						<script>
							window.client = new ImportClient({
								uri: '${C.getRoot().server.uri}'
							});
							if (${auto}) {
								client
									.import(window.IMPORT_REQUEST)
									.then(result => console.log(result))
									.catch(err => console.error(err.stack))
									.then(() => console.timeEnd('client:import'));
							}
						</script>
					</body>
				</html>
			`;
    });
  }
  /**
   * FIXME: This is weird, but it's presumably common for
   * static assets to live in '<root>/static', which means
   * their paths would be of the form '/static/static/<asset>'.
   */


  router.get('/static(/static)?/:path(.*)', async ctx => {
    const {
      path
    } = ctx.params;

    if (staticFiles.has(path)) {
      ctx.body = await getResponseBody(path);
      ctx.type = _path.default.extname(path);
    }
  });
  router.get('/manifest(/)?:request(.*)', async (ctx, next) => {
    try {
      const types = new Set((ctx.query.types || 'js').split(','));
      const {
        manifestPath,
        moduleId,
        pid,
        resolved
      } = scopeResolver(ctx.params.request);
      ctx.set('x-module-id', moduleId);
      ctx.set('x-pointer-id', pid);
      ctx.set('x-resource-type', getResourceType(resolved));
      ctx.body = getManifestJSON(manifestPath, {
        dependencyFilter: meta => types.has(meta.type)
      });
      ctx.type = '.json';
    } catch (err) {
      if (err.code !== 'ENOENT' && err.code !== 'MODULE_NOT_FOUND') {
        throw err;
      }

      await next();
    }
  });
  router.get('/render(/)?:request(.*)', ctx => {
    ctx.body = renderStaticTags(ctx.params.request, ctx.query.type);
  });
  router.get('/_/~/:request(.*)', async (ctx, next) => {
    try {
      const resolved = _path.default.join(C.outputDir, ctx.params.request);

      ctx.set('x-resource-type', getResourceType(resolved));
      ctx.body = await getResponseBody(resolved);
      ctx.type = _path.default.extname(resolved);
    } catch (err) {
      if (err.code !== 'ENOENT') {
        throw err;
      }

      await next();
    }
  });
  router.get('/_(/)?:request(.*)', async (ctx, next) => {
    try {
      const {
        resolved,
        moduleId,
        pid
      } = scopeResolver(ctx.params.request);
      ctx.set('x-module-id', moduleId);
      ctx.set('x-pointer-id', pid);
      ctx.set('x-resource-type', getResourceType(resolved));

      if (ctx.method === 'HEAD') {
        // fast return for resolve calls
        ctx.status = 204;
      } else {
        ctx.body = await getResponseBody(resolved);
        ctx.type = _path.default.extname(resolved);
      } // FOR DEVELOPMENT ONLY!!! REMOVE!!!

      /* istanbul ignore next */


      if (ENV !== 'production' && ctx.query.eval) {
        // eslint-disable-next-line global-require
        const {
          default: Client
        } = require('../client');

        const client = new Client({
          uri: C.server.uri
        });

        const profileEnd = _logger.default.profile();

        client.import(moduleId).then(result => {
          _logger.default.info(result);

          profileEnd(`import ${moduleId}`);
        }).catch(err => _logger.default.error(err));
      }
    } catch (err) {
      if (err.code !== 'ENOENT' && err.code !== 'MODULE_NOT_FOUND') {
        throw err;
      }

      await next();
    }
  });
  router.get('/_(/)?:request(.*).map', async (ctx, next) => {
    try {
      const {
        sourceMap
      } = scopeResolver(ctx.params.request);
      ctx.body = await getResponseBody(sourceMap);
      ctx.type = _path.default.extname(sourceMap);
    } catch (err) {
      if (err.code !== 'ENOENT' && err.code !== 'MODULE_NOT_FOUND') {
        throw err;
      }

      await next();
    }
  });

  if (C.server.redirects) {
    router.get('(.*)', ctx => {
      const regexp = new RegExp(`${(0, _escapeRegExp.default)(basePathname)}/?`);
      const request = ctx.path.replace(regexp, '');
      let location;

      try {
        const {
          moduleId
        } = scopeResolver(request);
        location = getResourcePath(moduleId, ctx.query);
      } catch (err) {
        if (err.code !== 'MODULE_NOT_FOUND') {
          throw err;
        }

        location = _path.default.join(basePathname, '/_', request);
      }

      ctx.redirect(location);
    });
  }

  router.use(ctx => {
    ctx.status = 404;
    ctx.body = {
      message: `Cannot find module '${ctx.path}'`,
      status: 404,
      code: 'MODULE_NOT_FOUND',
      path: ctx.path
    };
  });
  return new _koaRouter.default().use(`/${C.scopeKey}`, router.routes(), router.allowedMethods());
}

function createServer(C, watcher) {
  const app = new _koa.default();
  const appRouter = new _koaRouter.default();
  const basePublicPath = C.getRoot().get(['server', 'publicPath']);
  let statusCounts;

  if (ENV === 'test') {
    statusCounts = new Map();
    appRouter.use(async (ctx, next) => {
      await next();

      if (!statusCounts.get(ctx.status)) {
        statusCounts.set(ctx.status, 0);
      }

      statusCounts.set(ctx.status, statusCounts.get(ctx.status) + 1);
    });
  }

  appRouter.get('/up/', ctx => {
    ctx.state.noLog = true;
    ctx.body = 'OK';
  });
  C.scopes().forEach(scope => {
    const c = C.use(scope);
    const publicPath = c.get(['server', 'publicPath']);
    const scopeRouter = createScopeRouter(c, watcher);
    appRouter.get(_path.default.join(basePublicPath, '/@static/:request(.*)'), async (ctx, next) => {
      ctx.path = (0, _urlBuilder.assembleResourceURL)({
        pathname: publicPath
      }, ctx.params.request);
      await scopeRouter.routes()(ctx, next);

      if (ctx.status === 404) {
        ctx.url = ctx.originalUrl;
        await next();
      }
    });
    appRouter.use('(.*)', scopeRouter.routes(), scopeRouter.allowedMethods());
  });
  app.use((0, _timing.default)()).use((0, _koaConditionalGet.default)()).use((0, _koaEtag.default)()).use(appRouter.routes()).use(appRouter.allowedMethods()).use(ctx => {
    ctx.status = 404;
    ctx.body = {
      message: 'Not Found'
    };
  });
  app.on('error', err => {
    _logger.default.error(err);
  });

  const server = _http.default.createServer(app.callback());

  return {
    app,
    server,
    statusCounts
  };
}

function Server(options) {
  const C = _configStore.default.from(options);

  const watcher = new _watcher.default();
  const installers = C.scopes().map(scope => {
    const c = C.use(scope);

    const scopeLogger = _logger.default.child({
      name: c.scopeKey
    });

    const install = new _installer.default(c);
    return async (force, ...other) => {
      const {
        resourceFactory
      } = await install(force, ...other);

      if (c.watch) {
        watcher.subscribe(resourceFactory, async events => {
          events.forEach(([, resource]) => resource.markDirty());
          await install(false, ...other);
        });
        watcher.on('error', err => {
          scopeLogger.error(err.frame || err);
        });
        watcher.once('ready', () => {
          scopeLogger.info(`Watching '${_path.default.relative(process.cwd(), c.entryDir) || '.'}' for changes`);
        });
      }

      return resourceFactory();
    };
  });
  let app;
  let server;
  let statusCounts;

  function listen(port = C.server.port) {
    if (!server) {
      ({
        app,
        server,
        statusCounts
      } = createServer(C, watcher));
    }

    return new Promise(resolve => {
      server.listen(port, resolve);
    }).then(() => {
      _logger.default.info(`Listening on ${server.address().port}`);
    });
  }

  async function close() {
    watcher.close();

    if (server) {
      await server.close();
    }
  }

  return Object.freeze({
    install: async (...args) => {
      watcher.reset();
      const result = await Promise.all(installers.map(install => install(...args)));
      await watcher.start();
      return result;
    },
    watcher,
    listen,
    close,

    get app() {
      return app;
    },

    get server() {
      return server;
    },

    get statusCounts() {
      return statusCounts;
    }

  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2ZXIvaW5kZXguanMiXSwibmFtZXMiOlsiRU5WIiwicHJvY2VzcyIsImVudiIsIkJVSUxEX0VOViIsIk5PREVfRU5WIiwiQkFCRUxfRU5WIiwiZ2V0UmVzcG9uc2VCb2R5IiwicGF0aCIsImdlbmVyYXRlVGFnIiwidHlwZSIsInRhcmdldCIsIm90aGVyIiwiYXR0cmlidXRlcyIsIk9iamVjdCIsImVudHJpZXMiLCJtYXAiLCJrZXkiLCJ2YWx1ZSIsImpvaW4iLCJjcmVhdGVTY29wZVJvdXRlciIsIkMiLCJ3YXRjaGVyIiwicm91dGVyIiwiUm91dGVyIiwiY29udGV4dEZhY3RvcnkiLCJvdXRwdXRQYXRoIiwiUmVzb3VyY2VGYWN0b3J5IiwiZ2V0TW9kdWxlTWFwIiwibW9kdWxlcyIsInJlcXVpcmUiLCJzZXRJbW1lZGlhdGUiLCJjYWNoZSIsImNsZWFyIiwid2F0Y2giLCJvbmNlIiwiZ2V0QXNzZXRNYXAiLCJhc3NldHMiLCJiYXNlUGF0aG5hbWUiLCJVcmwiLCJwYXJzZSIsInNlcnZlciIsInVyaSIsInBhdGhuYW1lIiwic3RhdGljRmlsZXMiLCJzdGF0aWMiLCJnZXRNYW5pZmVzdEpTT04iLCJvcHRzIiwianNvbiIsImFzc2V0TWFwIiwic2NvcGVSZXNvbHZlciIsInJlcXVlc3QiLCJzYWZlIiwiY3R4IiwiZW50cnkiLCJyZXBsYWNlIiwiZXJyb3IiLCJtYXBwZWRTbHVnIiwic2x1ZyIsIm1hbmlmZXN0UGF0aCIsIm91dHB1dERpciIsInJlc29sdmVkIiwic291cmNlTWFwIiwiZ2V0UmVzb3VyY2VUeXBlIiwiUGF0aCIsImV4dG5hbWUiLCJnZXRSZXNvdXJjZVBhdGgiLCJtb2R1bGVJZCIsInF1ZXJ5IiwicmVuZGVyU3RhdGljVGFncyIsIm1hbmlmZXN0IiwiTWFuaWZlc3QiLCJsb2FkIiwiZGVwZW5kZW5jeUZpbHRlciIsIm1ldGEiLCJ0YWdzIiwibGlzdCIsInJlZHVjZSIsImFjYyIsImFzc2V0SWQiLCJnZXRBc3NldElkIiwiaGFzIiwic2V0IiwiZ2V0VHlwZSIsImdldFBpZCIsIk1hcCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2YWx1ZXMiLCJnZXQiLCJwYXJhbXMiLCJhdXRvIiwiZHluYW1pYyIsIkJvb2xlYW4iLCJib2R5Iiwic2NvcGVLZXkiLCJpbXBvcnQiLCJnZXRSb290IiwibmV4dCIsInR5cGVzIiwiU2V0Iiwic3BsaXQiLCJwaWQiLCJlcnIiLCJjb2RlIiwibWV0aG9kIiwic3RhdHVzIiwiZXZhbCIsImRlZmF1bHQiLCJDbGllbnQiLCJjbGllbnQiLCJwcm9maWxlRW5kIiwibG9nZ2VyIiwicHJvZmlsZSIsInRoZW4iLCJyZXN1bHQiLCJpbmZvIiwiY2F0Y2giLCJyZWRpcmVjdHMiLCJyZWdleHAiLCJSZWdFeHAiLCJsb2NhdGlvbiIsInJlZGlyZWN0IiwidXNlIiwibWVzc2FnZSIsInJvdXRlcyIsImFsbG93ZWRNZXRob2RzIiwiY3JlYXRlU2VydmVyIiwiYXBwIiwiS29hIiwiYXBwUm91dGVyIiwiYmFzZVB1YmxpY1BhdGgiLCJzdGF0dXNDb3VudHMiLCJzdGF0ZSIsIm5vTG9nIiwic2NvcGVzIiwiZm9yRWFjaCIsInNjb3BlIiwiYyIsInB1YmxpY1BhdGgiLCJzY29wZVJvdXRlciIsInVybCIsIm9yaWdpbmFsVXJsIiwib24iLCJodHRwIiwiY2FsbGJhY2siLCJTZXJ2ZXIiLCJvcHRpb25zIiwiQ29uZmlnU3RvcmUiLCJmcm9tIiwiV2F0Y2hlciIsImluc3RhbGxlcnMiLCJzY29wZUxvZ2dlciIsImNoaWxkIiwibmFtZSIsImluc3RhbGwiLCJJbnN0YWxsZXIiLCJmb3JjZSIsInJlc291cmNlRmFjdG9yeSIsInN1YnNjcmliZSIsImV2ZW50cyIsInJlc291cmNlIiwibWFya0RpcnR5IiwiZnJhbWUiLCJyZWxhdGl2ZSIsImN3ZCIsImVudHJ5RGlyIiwibGlzdGVuIiwicG9ydCIsIlByb21pc2UiLCJyZXNvbHZlIiwiYWRkcmVzcyIsImNsb3NlIiwiZnJlZXplIiwiYXJncyIsInJlc2V0IiwiYWxsIiwic3RhcnQi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cEIsUUFBSTJGLFlBQUosR0FBbUI7QUFDbEIsYUFBT0EsWUFBUDtBQUNBOztBQWxCbUIsR0FBZCxDQUFQO0FBb0JBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGh0dHAgZnJvbSAnaHR0cCc7XG5pbXBvcnQgVXJsIGZyb20gJ3VybCc7XG5pbXBvcnQgUGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IEtvYSBmcm9tICdrb2EnO1xuaW1wb3J0IFJvdXRlciBmcm9tICdrb2Etcm91dGVyJztcbmltcG9ydCBldGFnIGZyb20gJ2tvYS1ldGFnJztcbmltcG9ydCBjb25kaXRpb25hbCBmcm9tICdrb2EtY29uZGl0aW9uYWwtZ2V0JztcblxuaW1wb3J0IGxvZ2dlciBmcm9tICcuLi9saWIvbG9nZ2VyJztcbmltcG9ydCBlc2NhcGVSZWdFeHAgZnJvbSAnLi4vbGliL2hlbHBlcnMvZXNjYXBlUmVnRXhwJztcbmltcG9ydCBvbmNlIGZyb20gJy4uL2xpYi9oZWxwZXJzL29uY2UnO1xuaW1wb3J0IHBpY2sgZnJvbSAnLi4vbGliL2hlbHBlcnMvcGljayc7XG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jIH0gZnJvbSAnLi4vbGliL2hlbHBlcnMvZnMnO1xuaW1wb3J0IE1hbmlmZXN0IGZyb20gJy4uL2xpYi9tYW5pZmVzdCc7XG5pbXBvcnQgQ29uZmlnU3RvcmUgZnJvbSAnLi4vbGliL2NvbmZpZy1zdG9yZSc7XG5pbXBvcnQgeyBhc3NlbWJsZVJlc291cmNlVVJMLCBnZXRSZXNvdXJjZVBhdGhGcm9tSUQgfSBmcm9tICcuLi9saWIvdXJsLWJ1aWxkZXInO1xuaW1wb3J0IHsgZ2V0TWFuaWZlc3RQYXRoLCBzbHVnVG9BYnNvbHV0ZVBhdGggfSBmcm9tICcuL2luc3RhbGxlci9jb250ZXh0JztcbmltcG9ydCBSZXNvdXJjZUZhY3RvcnkgZnJvbSAnLi9pbnN0YWxsZXIvcmVzb3VyY2UnO1xuaW1wb3J0IEluc3RhbGxlciBmcm9tICcuL2luc3RhbGxlcic7XG5pbXBvcnQgV2F0Y2hlciBmcm9tICcuL2luc3RhbGxlci93YXRjaGVyJztcblxuaW1wb3J0IHRpbWluZ01pZGRsZXdhcmUgZnJvbSAnLi9taWRkbGV3YXJlL3RpbWluZyc7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm9jZXNzLWVudlxuY29uc3QgRU5WID0gcHJvY2Vzcy5lbnYuQlVJTERfRU5WIHx8IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IHByb2Nlc3MuZW52LkJBQkVMX0VOVjtcblxuZnVuY3Rpb24gZ2V0UmVzcG9uc2VCb2R5KHBhdGgpIHtcblx0cmV0dXJuIHJlYWRGaWxlQXN5bmMocGF0aCwgbnVsbCk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVGFnKHsgdHlwZSwgdGFyZ2V0LCAuLi5vdGhlciB9KSB7XG5cdGNvbnN0IGF0dHJpYnV0ZXMgPSBPYmplY3QuZW50cmllcyhvdGhlcilcblx0XHQubWFwKChba2V5LCB2YWx1ZV0pID0+ICh2YWx1ZSA9PT0gdHJ1ZSA/IGtleSA6IGAke2tleX09XCIke3ZhbHVlfVwiYCkpXG5cdFx0LmpvaW4oJyAnKTtcblx0c3dpdGNoICh0eXBlKSB7XG5cdFx0Y2FzZSAnY3NzJzpcblx0XHRcdHJldHVybiBgPGxpbmsgaHJlZj1cIiR7dGFyZ2V0fVwiIHJlbD1cInN0eWxlc2hlZXRcIiAke2F0dHJpYnV0ZXN9IC8+YDtcblx0XHRjYXNlICdqcyc6XG5cdFx0XHRyZXR1cm4gYDxzY3JpcHQgc3JjPVwiJHt0YXJnZXR9XCIgJHthdHRyaWJ1dGVzfT48L3NjcmlwdD5gO1xuXHRcdGNhc2UgJ2pzb24nOlxuXHRcdFx0cmV0dXJuIGA8c2NyaXB0IHR5cGU9XCJhcHBsaWNhdGlvbi9qc29uXCIgJHthdHRyaWJ1dGVzfT4ke3RhcmdldH08L3NjcmlwdD5gO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRyZXR1cm4gJyc7XG5cdH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2NvcGVSb3V0ZXIoQywgd2F0Y2hlcikge1xuXHRjb25zdCByb3V0ZXIgPSBuZXcgUm91dGVyKCk7XG5cdGNvbnN0IHsgY29udGV4dEZhY3RvcnksIG91dHB1dFBhdGggfSA9IG5ldyBSZXNvdXJjZUZhY3RvcnkoQyk7XG5cblx0Y29uc3QgZ2V0TW9kdWxlTWFwID0gb25jZSgoKSA9PiB7XG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGdsb2JhbC1yZXF1aXJlLCBpbXBvcnQvbm8tZHluYW1pYy1yZXF1aXJlXG5cdFx0Y29uc3QgeyBtb2R1bGVzIH0gPSByZXF1aXJlKG91dHB1dFBhdGgpO1xuXHRcdGlmIChFTlYgPT09ICd0ZXN0Jykge1xuXHRcdFx0c2V0SW1tZWRpYXRlKCgpID0+IHtcblx0XHRcdFx0ZGVsZXRlIHJlcXVpcmUuY2FjaGVbb3V0cHV0UGF0aF07XG5cdFx0XHRcdGdldE1vZHVsZU1hcC5jbGVhcigpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmIChDLndhdGNoKSB7XG5cdFx0XHR3YXRjaGVyLm9uY2UoJ2JlZm9yZXVwZGF0ZScsICgpID0+IHtcblx0XHRcdFx0ZGVsZXRlIHJlcXVpcmUuY2FjaGVbb3V0cHV0UGF0aF07XG5cdFx0XHRcdGdldE1vZHVsZU1hcC5jbGVhcigpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHJldHVybiBtb2R1bGVzO1xuXHR9KTtcblxuXHRjb25zdCBnZXRBc3NldE1hcCA9IG9uY2UoKCkgPT4ge1xuXHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZSwgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZVxuXHRcdGNvbnN0IHsgYXNzZXRzIH0gPSByZXF1aXJlKG91dHB1dFBhdGgpO1xuXHRcdGlmIChFTlYgPT09ICd0ZXN0Jykge1xuXHRcdFx0c2V0SW1tZWRpYXRlKCgpID0+IHtcblx0XHRcdFx0ZGVsZXRlIHJlcXVpcmUuY2FjaGVbb3V0cHV0UGF0aF07XG5cdFx0XHRcdGdldEFzc2V0TWFwLmNsZWFyKCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKEMud2F0Y2gpIHtcblx0XHRcdHdhdGNoZXIub25jZSgnYmVmb3JldXBkYXRlJywgKCkgPT4ge1xuXHRcdFx0XHRkZWxldGUgcmVxdWlyZS5jYWNoZVtvdXRwdXRQYXRoXTtcblx0XHRcdFx0Z2V0QXNzZXRNYXAuY2xlYXIoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRyZXR1cm4gYXNzZXRzO1xuXHR9KTtcblxuXHRjb25zdCBiYXNlUGF0aG5hbWUgPSBVcmwucGFyc2UoQy5zZXJ2ZXIudXJpKS5wYXRobmFtZTtcblx0Y29uc3Qgc3RhdGljRmlsZXMgPSBDLnNlcnZlci5zdGF0aWM7XG5cblx0ZnVuY3Rpb24gZ2V0TWFuaWZlc3RKU09OKHBhdGgsIG9wdHMpIHtcblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ2xvYmFsLXJlcXVpcmUsIGltcG9ydC9uby1keW5hbWljLXJlcXVpcmVcblx0XHRjb25zdCBqc29uID0gcmVxdWlyZShwYXRoKSh7IGFzc2V0TWFwOiBnZXRBc3NldE1hcCgpLCAuLi5vcHRzIH0pO1xuXHRcdGlmIChFTlYgPT09ICd0ZXN0Jykge1xuXHRcdFx0ZGVsZXRlIHJlcXVpcmUuY2FjaGVbcGF0aF07XG5cdFx0fSBlbHNlIGlmIChDLndhdGNoKSB7XG5cdFx0XHR3YXRjaGVyLm9uY2UoJ2JlZm9yZXVwZGF0ZScsICgpID0+IHtcblx0XHRcdFx0ZGVsZXRlIHJlcXVpcmUuY2FjaGVbcGF0aF07XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0cmV0dXJuIGpzb247XG5cdH1cblxuXHRmdW5jdGlvbiBzY29wZVJlc29sdmVyKHJlcXVlc3QsIHNhZmUpIHtcblx0XHRjb25zdCBjdHggPSBjb250ZXh0RmFjdG9yeSgocmVxdWVzdCB8fCBDLmVudHJ5KS5yZXBsYWNlKC9eOnwoOlxcZCspezEsMn0kL2csICcnKSk7XG5cdFx0aWYgKGN0eC5lcnJvciAmJiAhc2FmZSkge1xuXHRcdFx0dGhyb3cgY3R4LmVycm9yO1xuXHRcdH1cblx0XHRjb25zdCBtYXBwZWRTbHVnID0gZ2V0TW9kdWxlTWFwKClbY3R4LnNsdWddIHx8IGN0eC5zbHVnO1xuXHRcdGNvbnN0IG1hbmlmZXN0UGF0aCA9IGdldE1hbmlmZXN0UGF0aChzbHVnVG9BYnNvbHV0ZVBhdGgoQy5vdXRwdXREaXIsIG1hcHBlZFNsdWcpKTtcblx0XHRjb25zdCByZXNvbHZlZCA9IHNsdWdUb0Fic29sdXRlUGF0aChDLm91dHB1dERpciwgZ2V0QXNzZXRNYXAoKVttYXBwZWRTbHVnXSB8fCBtYXBwZWRTbHVnKTtcblx0XHRjb25zdCBzb3VyY2VNYXAgPSBzbHVnVG9BYnNvbHV0ZVBhdGgoQy5vdXRwdXREaXIsIGAke2N0eC5zbHVnfS5tYXBgKTtcblx0XHRyZXR1cm4ge1xuXHRcdFx0Li4ucGljayhjdHgsIFsnZXJyb3InLCAnbW9kdWxlSWQnLCAnb3JpZ2luJywgJ3BpZCddKSxcblx0XHRcdG1hbmlmZXN0UGF0aCxcblx0XHRcdHJlc29sdmVkLFxuXHRcdFx0c291cmNlTWFwXG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldFJlc291cmNlVHlwZShyZXNvbHZlZCkge1xuXHRcdGNvbnN0IHR5cGUgPSBQYXRoLmV4dG5hbWUocmVzb2x2ZWQpLnJlcGxhY2UoL15cXC4vLCAnJyk7XG5cdFx0cmV0dXJuIHR5cGUgPT09ICdjc3MnIHx8IHR5cGUgPT09ICdqcycgPyB0eXBlIDogJ3Jhdyc7XG5cdH1cblxuXHRmdW5jdGlvbiBnZXRSZXNvdXJjZVBhdGgobW9kdWxlSWQsIHF1ZXJ5KSB7XG5cdFx0cmV0dXJuIGFzc2VtYmxlUmVzb3VyY2VVUkwoeyBwYXRobmFtZTogYmFzZVBhdGhuYW1lIH0sIG1vZHVsZUlkLCBxdWVyeSk7XG5cdH1cblxuXHRmdW5jdGlvbiByZW5kZXJTdGF0aWNUYWdzKHJlcXVlc3QsIHR5cGUpIHtcblx0XHRjb25zdCBjdHggPSBzY29wZVJlc29sdmVyKHJlcXVlc3QpO1xuXHRcdGNvbnN0IG1hbmlmZXN0ID0gTWFuaWZlc3QubG9hZChcblx0XHRcdGdldE1hbmlmZXN0SlNPTihjdHgubWFuaWZlc3RQYXRoLCB7XG5cdFx0XHRcdGRlcGVuZGVuY3lGaWx0ZXI6IG1ldGEgPT4gIXR5cGUgfHwgdHlwZSA9PT0gbWV0YS50eXBlXG5cdFx0XHR9KVxuXHRcdCk7XG5cblx0XHRjb25zdCB0YWdzID0gbWFuaWZlc3QubGlzdCgpLnJlZHVjZSgoYWNjLCBtb2R1bGVJZCkgPT4ge1xuXHRcdFx0Y29uc3QgYXNzZXRJZCA9IG1hbmlmZXN0LmdldEFzc2V0SWQobW9kdWxlSWQpO1xuXHRcdFx0aWYgKCFhY2MuaGFzKGFzc2V0SWQpICYmIGFzc2V0SWQgIT09IG1hbmlmZXN0Lm1ldGEoJ2Fzc2V0SWQnKSkge1xuXHRcdFx0XHRhY2Muc2V0KFxuXHRcdFx0XHRcdGFzc2V0SWQsXG5cdFx0XHRcdFx0Z2VuZXJhdGVUYWcoe1xuXHRcdFx0XHRcdFx0dGFyZ2V0OiBnZXRSZXNvdXJjZVBhdGgoYXNzZXRJZCksXG5cdFx0XHRcdFx0XHR0eXBlOiBtYW5pZmVzdC5nZXRUeXBlKG1vZHVsZUlkKSxcblx0XHRcdFx0XHRcdCdkYXRhLXBpZCc6IG1hbmlmZXN0LmdldFBpZChtb2R1bGVJZCksXG5cdFx0XHRcdFx0XHQnZGF0YS1yZW1vdGUtbW9kdWxlcyc6IHRydWVcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGFjYztcblx0XHR9LCBuZXcgTWFwKCkpO1xuXG5cdFx0aWYgKCF0eXBlIHx8IHR5cGUgPT09IG1hbmlmZXN0Lm1ldGEoJ3R5cGUnKSkge1xuXHRcdFx0dGFncy5zZXQoXG5cdFx0XHRcdG1hbmlmZXN0Lm1ldGEoJ2Fzc2V0SWQnKSxcblx0XHRcdFx0Z2VuZXJhdGVUYWcoe1xuXHRcdFx0XHRcdHR5cGU6IG1hbmlmZXN0Lm1ldGEoJ3R5cGUnKSxcblx0XHRcdFx0XHR0YXJnZXQ6IGdldFJlc291cmNlUGF0aChtYW5pZmVzdC5tZXRhKCdhc3NldElkJykpLFxuXHRcdFx0XHRcdCdkYXRhLW1vZHVsZS1pZCc6IG1hbmlmZXN0Lm1ldGEoJ21vZHVsZUlkJyksXG5cdFx0XHRcdFx0J2RhdGEtcGlkJzogbWFuaWZlc3QubWV0YSgncGlkJyksXG5cdFx0XHRcdFx0J2RhdGEtbWFpbic6IHRydWUsXG5cdFx0XHRcdFx0J2RhdGEtcmVtb3RlLW1vZHVsZXMnOiB0cnVlXG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICghdHlwZSB8fCB0eXBlID09PSAnanMnKSB7XG5cdFx0XHR0YWdzLnNldChcblx0XHRcdFx0Y3R4Lm1hbmlmZXN0UGF0aCxcblx0XHRcdFx0Z2VuZXJhdGVUYWcoe1xuXHRcdFx0XHRcdHR5cGU6ICdqc29uJyxcblx0XHRcdFx0XHR0YXJnZXQ6IEpTT04uc3RyaW5naWZ5KFxuXHRcdFx0XHRcdFx0Z2V0TWFuaWZlc3RKU09OKGN0eC5tYW5pZmVzdFBhdGgsIHtcblx0XHRcdFx0XHRcdFx0ZGVwZW5kZW5jeUZpbHRlcjogbWV0YSA9PiBtZXRhLnR5cGUgIT09ICdyYXcnXG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdCksXG5cdFx0XHRcdFx0J2RhdGEtbW9kdWxlLWlkJzogbWFuaWZlc3QubWV0YSgnbW9kdWxlSWQnKSxcblx0XHRcdFx0XHQnZGF0YS1waWQnOiBtYW5pZmVzdC5tZXRhKCdwaWQnKSxcblx0XHRcdFx0XHQnZGF0YS1yZW1vdGUtbW9kdWxlcyc6IHRydWVcblx0XHRcdFx0fSlcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFsuLi50YWdzLnZhbHVlcygpXS5qb2luKCdcXG4nKTtcblx0fVxuXG5cdC8vIEZPUiBERVZFTE9QTUVOVCBPTkxZISEhIFJFTU9WRSEhIVxuXHRpZiAoRU5WICE9PSAncHJvZHVjdGlvbicpIHtcblx0XHRyb3V0ZXIuZ2V0KCcvYnJvd3NlcigvKT86cmVxdWVzdCguKiknLCBhc3luYyBjdHggPT4gLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8ge1xuXHRcdFx0Y29uc3QgeyByZXF1ZXN0IH0gPSBjdHgucGFyYW1zO1xuXHRcdFx0Y29uc3QgeyBtb2R1bGVJZCB9ID0gc2NvcGVSZXNvbHZlcihyZXF1ZXN0KTtcblx0XHRcdGNvbnN0IGF1dG8gPSBjdHgucXVlcnkuYXV0byAhPT0gJ2ZhbHNlJztcblx0XHRcdGNvbnN0IGR5bmFtaWMgPSBCb29sZWFuKGN0eC5xdWVyeS5keW5hbWljKTtcblx0XHRcdGN0eC5ib2R5ID0gYFxuXHRcdFx0XHQ8aHRtbD5cblx0XHRcdFx0XHQ8aGVhZD5cblx0XHRcdFx0XHRcdCR7ZHluYW1pYyA/ICcnIDogcmVuZGVyU3RhdGljVGFncyhyZXF1ZXN0LCAnY3NzJyl9XG5cdFx0XHRcdFx0PC9oZWFkPlxuXHRcdFx0XHRcdDxib2R5PlxuXHRcdFx0XHRcdFx0PHNjcmlwdD5cblx0XHRcdFx0XHRcdFx0d2luZG93LklNUE9SVF9TQ09QRSA9ICcke0Muc2NvcGVLZXl9Jztcblx0XHRcdFx0XHRcdFx0d2luZG93LklNUE9SVF9SRVFVRVNUID0gJyR7Y3R4LnF1ZXJ5LmltcG9ydCB8fFxuXHRcdFx0XHRcdFx0XHRcdGA8JHtDLnNjb3BlS2V5fT4vJHtnZXRSZXNvdXJjZVBhdGhGcm9tSUQobW9kdWxlSWQpfWB9Jztcblx0XHRcdFx0XHRcdFx0Y29uc29sZS50aW1lKCdjbGllbnQ6aW1wb3J0Jyk7XG5cdFx0XHRcdFx0XHQ8L3NjcmlwdD5cblx0XHRcdFx0XHRcdCR7ZHluYW1pYyA/ICcnIDogcmVuZGVyU3RhdGljVGFncyhyZXF1ZXN0LCAnanMnKX1cblx0XHRcdFx0XHRcdDxzY3JpcHQgc3JjPVwiJHtiYXNlUGF0aG5hbWV9L3N0YXRpYy9kaXN0L2NsaWVudC5icm93c2VyLmpzXCI+PC9zY3JpcHQ+XG5cdFx0XHRcdFx0XHQ8c2NyaXB0PlxuXHRcdFx0XHRcdFx0XHR3aW5kb3cuY2xpZW50ID0gbmV3IEltcG9ydENsaWVudCh7XG5cdFx0XHRcdFx0XHRcdFx0dXJpOiAnJHtDLmdldFJvb3QoKS5zZXJ2ZXIudXJpfSdcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGlmICgke2F1dG99KSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2xpZW50XG5cdFx0XHRcdFx0XHRcdFx0XHQuaW1wb3J0KHdpbmRvdy5JTVBPUlRfUkVRVUVTVClcblx0XHRcdFx0XHRcdFx0XHRcdC50aGVuKHJlc3VsdCA9PiBjb25zb2xlLmxvZyhyZXN1bHQpKVxuXHRcdFx0XHRcdFx0XHRcdFx0LmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKGVyci5zdGFjaykpXG5cdFx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiBjb25zb2xlLnRpbWVFbmQoJ2NsaWVudDppbXBvcnQnKSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdDwvc2NyaXB0PlxuXHRcdFx0XHRcdDwvYm9keT5cblx0XHRcdFx0PC9odG1sPlxuXHRcdFx0YDtcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGSVhNRTogVGhpcyBpcyB3ZWlyZCwgYnV0IGl0J3MgcHJlc3VtYWJseSBjb21tb24gZm9yXG5cdCAqIHN0YXRpYyBhc3NldHMgdG8gbGl2ZSBpbiAnPHJvb3Q+L3N0YXRpYycsIHdoaWNoIG1lYW5zXG5cdCAqIHRoZWlyIHBhdGhzIHdvdWxkIGJlIG9mIHRoZSBmb3JtICcvc3RhdGljL3N0YXRpYy88YXNzZXQ+Jy5cblx0ICovXG5cdHJvdXRlci5nZXQoJy9zdGF0aWMoL3N0YXRpYyk/LzpwYXRoKC4qKScsIGFzeW5jIGN0eCA9PiB7XG5cdFx0Y29uc3QgeyBwYXRoIH0gPSBjdHgucGFyYW1zO1xuXHRcdGlmIChzdGF0aWNGaWxlcy5oYXMocGF0aCkpIHtcblx0XHRcdGN0eC5ib2R5ID0gYXdhaXQgZ2V0UmVzcG9uc2VCb2R5KHBhdGgpO1xuXHRcdFx0Y3R4LnR5cGUgPSBQYXRoLmV4dG5hbWUocGF0aCk7XG5cdFx0fVxuXHR9KTtcblxuXHRyb3V0ZXIuZ2V0KCcvbWFuaWZlc3QoLyk/OnJlcXVlc3QoLiopJywgYXN5bmMgKGN0eCwgbmV4dCkgPT4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCB0eXBlcyA9IG5ldyBTZXQoKGN0eC5xdWVyeS50eXBlcyB8fCAnanMnKS5zcGxpdCgnLCcpKTtcblx0XHRcdGNvbnN0IHsgbWFuaWZlc3RQYXRoLCBtb2R1bGVJZCwgcGlkLCByZXNvbHZlZCB9ID0gc2NvcGVSZXNvbHZlcihjdHgucGFyYW1zLnJlcXVlc3QpO1xuXHRcdFx0Y3R4LnNldCgneC1tb2R1bGUtaWQnLCBtb2R1bGVJZCk7XG5cdFx0XHRjdHguc2V0KCd4LXBvaW50ZXItaWQnLCBwaWQpO1xuXHRcdFx0Y3R4LnNldCgneC1yZXNvdXJjZS10eXBlJywgZ2V0UmVzb3VyY2VUeXBlKHJlc29sdmVkKSk7XG5cdFx0XHRjdHguYm9keSA9IGdldE1hbmlmZXN0SlNPTihtYW5pZmVzdFBhdGgsIHtcblx0XHRcdFx0ZGVwZW5kZW5jeUZpbHRlcjogbWV0YSA9PiB0eXBlcy5oYXMobWV0YS50eXBlKVxuXHRcdFx0fSk7XG5cdFx0XHRjdHgudHlwZSA9ICcuanNvbic7XG5cdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRpZiAoZXJyLmNvZGUgIT09ICdFTk9FTlQnICYmIGVyci5jb2RlICE9PSAnTU9EVUxFX05PVF9GT1VORCcpIHtcblx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0fVxuXHRcdFx0YXdhaXQgbmV4dCgpO1xuXHRcdH1cblx0fSk7XG5cblx0cm91dGVyLmdldCgnL3JlbmRlcigvKT86cmVxdWVzdCguKiknLCBjdHggPT4ge1xuXHRcdGN0eC5ib2R5ID0gcmVuZGVyU3RhdGljVGFncyhjdHgucGFyYW1zLnJlcXVlc3QsIGN0eC5xdWVyeS50eXBlKTtcblx0fSk7XG5cblx0cm91dGVyLmdldCgnL18vfi86cmVxdWVzdCguKiknLCBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHJlc29sdmVkID0gUGF0aC5qb2luKEMub3V0cHV0RGlyLCBjdHgucGFyYW1zLnJlcXVlc3QpO1xuXHRcdFx0Y3R4LnNldCgneC1yZXNvdXJjZS10eXBlJywgZ2V0UmVzb3VyY2VUeXBlKHJlc29sdmVkKSk7XG5cdFx0XHRjdHguYm9keSA9IGF3YWl0IGdldFJlc3BvbnNlQm9keShyZXNvbHZlZCk7XG5cdFx0XHRjdHgudHlwZSA9IFBhdGguZXh0bmFtZShyZXNvbHZlZCk7XG5cdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRpZiAoZXJyLmNvZGUgIT09ICdFTk9FTlQnKSB7XG5cdFx0XHRcdHRocm93IGVycjtcblx0XHRcdH1cblx0XHRcdGF3YWl0IG5leHQoKTtcblx0XHR9XG5cdH0pO1xuXG5cdHJvdXRlci5nZXQoJy9fKC8pPzpyZXF1ZXN0KC4qKScsIGFzeW5jIChjdHgsIG5leHQpID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgeyByZXNvbHZlZCwgbW9kdWxlSWQsIHBpZCB9ID0gc2NvcGVSZXNvbHZlcihjdHgucGFyYW1zLnJlcXVlc3QpO1xuXHRcdFx0Y3R4LnNldCgneC1tb2R1bGUtaWQnLCBtb2R1bGVJZCk7XG5cdFx0XHRjdHguc2V0KCd4LXBvaW50ZXItaWQnLCBwaWQpO1xuXHRcdFx0Y3R4LnNldCgneC1yZXNvdXJjZS10eXBlJywgZ2V0UmVzb3VyY2VUeXBlKHJlc29sdmVkKSk7XG5cdFx0XHRpZiAoY3R4Lm1ldGhvZCA9PT0gJ0hFQUQnKSB7XG5cdFx0XHRcdC8vIGZhc3QgcmV0dXJuIGZvciByZXNvbHZlIGNhbGxzXG5cdFx0XHRcdGN0eC5zdGF0dXMgPSAyMDQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjdHguYm9keSA9IGF3YWl0IGdldFJlc3BvbnNlQm9keShyZXNvbHZlZCk7XG5cdFx0XHRcdGN0eC50eXBlID0gUGF0aC5leHRuYW1lKHJlc29sdmVkKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRk9SIERFVkVMT1BNRU5UIE9OTFkhISEgUkVNT1ZFISEhXG5cdFx0XHQvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuXHRcdFx0aWYgKEVOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIGN0eC5xdWVyeS5ldmFsKSB7XG5cdFx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZVxuXHRcdFx0XHRjb25zdCB7IGRlZmF1bHQ6IENsaWVudCB9ID0gcmVxdWlyZSgnLi4vY2xpZW50Jyk7XG5cdFx0XHRcdGNvbnN0IGNsaWVudCA9IG5ldyBDbGllbnQoeyB1cmk6IEMuc2VydmVyLnVyaSB9KTtcblx0XHRcdFx0Y29uc3QgcHJvZmlsZUVuZCA9IGxvZ2dlci5wcm9maWxlKCk7XG5cdFx0XHRcdGNsaWVudFxuXHRcdFx0XHRcdC5pbXBvcnQobW9kdWxlSWQpXG5cdFx0XHRcdFx0LnRoZW4ocmVzdWx0ID0+IHtcblx0XHRcdFx0XHRcdGxvZ2dlci5pbmZvKHJlc3VsdCk7XG5cdFx0XHRcdFx0XHRwcm9maWxlRW5kKGBpbXBvcnQgJHttb2R1bGVJZH1gKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5jYXRjaChlcnIgPT4gbG9nZ2VyLmVycm9yKGVycikpO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0aWYgKGVyci5jb2RlICE9PSAnRU5PRU5UJyAmJiBlcnIuY29kZSAhPT0gJ01PRFVMRV9OT1RfRk9VTkQnKSB7XG5cdFx0XHRcdHRocm93IGVycjtcblx0XHRcdH1cblx0XHRcdGF3YWl0IG5leHQoKTtcblx0XHR9XG5cdH0pO1xuXG5cdHJvdXRlci5nZXQoJy9fKC8pPzpyZXF1ZXN0KC4qKS5tYXAnLCBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHsgc291cmNlTWFwIH0gPSBzY29wZVJlc29sdmVyKGN0eC5wYXJhbXMucmVxdWVzdCk7XG5cdFx0XHRjdHguYm9keSA9IGF3YWl0IGdldFJlc3BvbnNlQm9keShzb3VyY2VNYXApO1xuXHRcdFx0Y3R4LnR5cGUgPSBQYXRoLmV4dG5hbWUoc291cmNlTWFwKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdGlmIChlcnIuY29kZSAhPT0gJ0VOT0VOVCcgJiYgZXJyLmNvZGUgIT09ICdNT0RVTEVfTk9UX0ZPVU5EJykge1xuXHRcdFx0XHR0aHJvdyBlcnI7XG5cdFx0XHR9XG5cdFx0XHRhd2FpdCBuZXh0KCk7XG5cdFx0fVxuXHR9KTtcblxuXHRpZiAoQy5zZXJ2ZXIucmVkaXJlY3RzKSB7XG5cdFx0cm91dGVyLmdldCgnKC4qKScsIGN0eCA9PiB7XG5cdFx0XHRjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKGAke2VzY2FwZVJlZ0V4cChiYXNlUGF0aG5hbWUpfS8/YCk7XG5cdFx0XHRjb25zdCByZXF1ZXN0ID0gY3R4LnBhdGgucmVwbGFjZShyZWdleHAsICcnKTtcblx0XHRcdGxldCBsb2NhdGlvbjtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IHsgbW9kdWxlSWQgfSA9IHNjb3BlUmVzb2x2ZXIocmVxdWVzdCk7XG5cdFx0XHRcdGxvY2F0aW9uID0gZ2V0UmVzb3VyY2VQYXRoKG1vZHVsZUlkLCBjdHgucXVlcnkpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdGlmIChlcnIuY29kZSAhPT0gJ01PRFVMRV9OT1RfRk9VTkQnKSB7XG5cdFx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGxvY2F0aW9uID0gUGF0aC5qb2luKGJhc2VQYXRobmFtZSwgJy9fJywgcmVxdWVzdCk7XG5cdFx0XHR9XG5cdFx0XHRjdHgucmVkaXJlY3QobG9jYXRpb24pO1xuXHRcdH0pO1xuXHR9XG5cblx0cm91dGVyLnVzZShjdHggPT4ge1xuXHRcdGN0eC5zdGF0dXMgPSA0MDQ7XG5cdFx0Y3R4LmJvZHkgPSB7XG5cdFx0XHRtZXNzYWdlOiBgQ2Fubm90IGZpbmQgbW9kdWxlICcke2N0eC5wYXRofSdgLFxuXHRcdFx0c3RhdHVzOiA0MDQsXG5cdFx0XHRjb2RlOiAnTU9EVUxFX05PVF9GT1VORCcsXG5cdFx0XHRwYXRoOiBjdHgucGF0aFxuXHRcdH07XG5cdH0pO1xuXG5cdHJldHVybiBuZXcgUm91dGVyKCkudXNlKGAvJHtDLnNjb3BlS2V5fWAsIHJvdXRlci5yb3V0ZXMoKSwgcm91dGVyLmFsbG93ZWRNZXRob2RzKCkpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTZXJ2ZXIoQywgd2F0Y2hlcikge1xuXHRjb25zdCBhcHAgPSBuZXcgS29hKCk7XG5cdGNvbnN0IGFwcFJvdXRlciA9IG5ldyBSb3V0ZXIoKTtcblx0Y29uc3QgYmFzZVB1YmxpY1BhdGggPSBDLmdldFJvb3QoKS5nZXQoWydzZXJ2ZXInLCAncHVibGljUGF0aCddKTtcblx0bGV0IHN0YXR1c0NvdW50cztcblxuXHRpZiAoRU5WID09PSAndGVzdCcpIHtcblx0XHRzdGF0dXNDb3VudHMgPSBuZXcgTWFwKCk7XG5cdFx0YXBwUm91dGVyLnVzZShhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG5cdFx0XHRhd2FpdCBuZXh0KCk7XG5cdFx0XHRpZiAoIXN0YXR1c0NvdW50cy5nZXQoY3R4LnN0YXR1cykpIHtcblx0XHRcdFx0c3RhdHVzQ291bnRzLnNldChjdHguc3RhdHVzLCAwKTtcblx0XHRcdH1cblx0XHRcdHN0YXR1c0NvdW50cy5zZXQoY3R4LnN0YXR1cywgc3RhdHVzQ291bnRzLmdldChjdHguc3RhdHVzKSArIDEpO1xuXHRcdH0pO1xuXHR9XG5cblx0YXBwUm91dGVyLmdldCgnL3VwLycsIGN0eCA9PiB7XG5cdFx0Y3R4LnN0YXRlLm5vTG9nID0gdHJ1ZTtcblx0XHRjdHguYm9keSA9ICdPSyc7XG5cdH0pO1xuXG5cdEMuc2NvcGVzKCkuZm9yRWFjaChzY29wZSA9PiB7XG5cdFx0Y29uc3QgYyA9IEMudXNlKHNjb3BlKTtcblx0XHRjb25zdCBwdWJsaWNQYXRoID0gYy5nZXQoWydzZXJ2ZXInLCAncHVibGljUGF0aCddKTtcblx0XHRjb25zdCBzY29wZVJvdXRlciA9IGNyZWF0ZVNjb3BlUm91dGVyKGMsIHdhdGNoZXIpO1xuXG5cdFx0YXBwUm91dGVyLmdldChQYXRoLmpvaW4oYmFzZVB1YmxpY1BhdGgsICcvQHN0YXRpYy86cmVxdWVzdCguKiknKSwgYXN5bmMgKGN0eCwgbmV4dCkgPT4ge1xuXHRcdFx0Y3R4LnBhdGggPSBhc3NlbWJsZVJlc291cmNlVVJMKHsgcGF0aG5hbWU6IHB1YmxpY1BhdGggfSwgY3R4LnBhcmFtcy5yZXF1ZXN0KTtcblx0XHRcdGF3YWl0IHNjb3BlUm91dGVyLnJvdXRlcygpKGN0eCwgbmV4dCk7XG5cdFx0XHRpZiAoY3R4LnN0YXR1cyA9PT0gNDA0KSB7XG5cdFx0XHRcdGN0eC51cmwgPSBjdHgub3JpZ2luYWxVcmw7XG5cdFx0XHRcdGF3YWl0IG5leHQoKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGFwcFJvdXRlci51c2UoJyguKiknLCBzY29wZVJvdXRlci5yb3V0ZXMoKSwgc2NvcGVSb3V0ZXIuYWxsb3dlZE1ldGhvZHMoKSk7XG5cdH0pO1xuXG5cdGFwcFxuXHRcdC51c2UodGltaW5nTWlkZGxld2FyZSgpKVxuXHRcdC51c2UoY29uZGl0aW9uYWwoKSlcblx0XHQudXNlKGV0YWcoKSlcblx0XHQudXNlKGFwcFJvdXRlci5yb3V0ZXMoKSlcblx0XHQudXNlKGFwcFJvdXRlci5hbGxvd2VkTWV0aG9kcygpKVxuXHRcdC51c2UoY3R4ID0+IHtcblx0XHRcdGN0eC5zdGF0dXMgPSA0MDQ7XG5cdFx0XHRjdHguYm9keSA9IHsgbWVzc2FnZTogJ05vdCBGb3VuZCcgfTtcblx0XHR9KTtcblxuXHRhcHAub24oJ2Vycm9yJywgZXJyID0+IHtcblx0XHRsb2dnZXIuZXJyb3IoZXJyKTtcblx0fSk7XG5cblx0Y29uc3Qgc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoYXBwLmNhbGxiYWNrKCkpO1xuXG5cdHJldHVybiB7IGFwcCwgc2VydmVyLCBzdGF0dXNDb3VudHMgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU2VydmVyKG9wdGlvbnMpIHtcblx0Y29uc3QgQyA9IENvbmZpZ1N0b3JlLmZyb20ob3B0aW9ucyk7XG5cdGNvbnN0IHdhdGNoZXIgPSBuZXcgV2F0Y2hlcigpO1xuXHRjb25zdCBpbnN0YWxsZXJzID0gQy5zY29wZXMoKS5tYXAoc2NvcGUgPT4ge1xuXHRcdGNvbnN0IGMgPSBDLnVzZShzY29wZSk7XG5cdFx0Y29uc3Qgc2NvcGVMb2dnZXIgPSBsb2dnZXIuY2hpbGQoeyBuYW1lOiBjLnNjb3BlS2V5IH0pO1xuXHRcdGNvbnN0IGluc3RhbGwgPSBuZXcgSW5zdGFsbGVyKGMpO1xuXHRcdHJldHVybiBhc3luYyAoZm9yY2UsIC4uLm90aGVyKSA9PiB7XG5cdFx0XHRjb25zdCB7IHJlc291cmNlRmFjdG9yeSB9ID0gYXdhaXQgaW5zdGFsbChmb3JjZSwgLi4ub3RoZXIpO1xuXHRcdFx0aWYgKGMud2F0Y2gpIHtcblx0XHRcdFx0d2F0Y2hlci5zdWJzY3JpYmUocmVzb3VyY2VGYWN0b3J5LCBhc3luYyBldmVudHMgPT4ge1xuXHRcdFx0XHRcdGV2ZW50cy5mb3JFYWNoKChbLCByZXNvdXJjZV0pID0+IHJlc291cmNlLm1hcmtEaXJ0eSgpKTtcblx0XHRcdFx0XHRhd2FpdCBpbnN0YWxsKGZhbHNlLCAuLi5vdGhlcik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR3YXRjaGVyLm9uKCdlcnJvcicsIGVyciA9PiB7XG5cdFx0XHRcdFx0c2NvcGVMb2dnZXIuZXJyb3IoZXJyLmZyYW1lIHx8IGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR3YXRjaGVyLm9uY2UoJ3JlYWR5JywgKCkgPT4ge1xuXHRcdFx0XHRcdHNjb3BlTG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgV2F0Y2hpbmcgJyR7UGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBjLmVudHJ5RGlyKSB8fCAnLid9JyBmb3IgY2hhbmdlc2Bcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXNvdXJjZUZhY3RvcnkoKTtcblx0XHR9O1xuXHR9KTtcblxuXHRsZXQgYXBwO1xuXHRsZXQgc2VydmVyO1xuXHRsZXQgc3RhdHVzQ291bnRzO1xuXG5cdGZ1bmN0aW9uIGxpc3Rlbihwb3J0ID0gQy5zZXJ2ZXIucG9ydCkge1xuXHRcdGlmICghc2VydmVyKSB7XG5cdFx0XHQoeyBhcHAsIHNlcnZlciwgc3RhdHVzQ291bnRzIH0gPSBjcmVhdGVTZXJ2ZXIoQywgd2F0Y2hlcikpO1xuXHRcdH1cblx0XHRyZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG5cdFx0XHRzZXJ2ZXIubGlzdGVuKHBvcnQsIHJlc29sdmUpO1xuXHRcdH0pLnRoZW4oKCkgPT4ge1xuXHRcdFx0bG9nZ2VyLmluZm8oYExpc3RlbmluZyBvbiAke3NlcnZlci5hZGRyZXNzKCkucG9ydH1gKTtcblx0XHR9KTtcblx0fVxuXG5cdGFzeW5jIGZ1bmN0aW9uIGNsb3NlKCkge1xuXHRcdHdhdGNoZXIuY2xvc2UoKTtcblx0XHRpZiAoc2VydmVyKSB7XG5cdFx0XHRhd2FpdCBzZXJ2ZXIuY2xvc2UoKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gT2JqZWN0LmZyZWV6ZSh7XG5cdFx0aW5zdGFsbDogYXN5bmMgKC4uLmFyZ3MpID0+IHtcblx0XHRcdHdhdGNoZXIucmVzZXQoKTtcblx0XHRcdGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb21pc2UuYWxsKGluc3RhbGxlcnMubWFwKGluc3RhbGwgPT4gaW5zdGFsbCguLi5hcmdzKSkpO1xuXHRcdFx0YXdhaXQgd2F0Y2hlci5zdGFydCgpO1xuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9LFxuXHRcdHdhdGNoZXIsXG5cdFx0bGlzdGVuLFxuXHRcdGNsb3NlLFxuXHRcdGdldCBhcHAoKSB7XG5cdFx0XHRyZXR1cm4gYXBwO1xuXHRcdH0sXG5cdFx0Z2V0IHNlcnZlcigpIHtcblx0XHRcdHJldHVybiBzZXJ2ZXI7XG5cdFx0fSxcblx0XHRnZXQgc3RhdHVzQ291bnRzKCkge1xuXHRcdFx0cmV0dXJuIHN0YXR1c0NvdW50cztcblx0XHR9XG5cdH0pO1xufVxuIl19
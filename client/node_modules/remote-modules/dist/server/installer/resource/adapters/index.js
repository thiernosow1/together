"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getAdapter = getAdapter;
exports.createAdapter = createAdapter;

var _get = _interopRequireDefault(require("../../../../lib/helpers/get"));

var _noop = _interopRequireDefault(require("../../../../lib/helpers/noop"));

var _raw = _interopRequireDefault(require("./raw"));

var _reader = _interopRequireDefault(require("./reader"));

var _writer = _interopRequireDefault(require("./writer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

function getDefaultVisitors(visitors = {}) {
  const visitorKeys = ['Read', 'Parse', 'Requests', 'Generate', 'Write', 'Complete'];

  const getSplitVisitor = (value = {}) => ({
    pre: (typeof value === 'function' ? value : value.pre) || _noop.default,
    post: value.post || _noop.default
  });

  return visitorKeys.reduce((acc, key) => {
    acc[key] = getSplitVisitor(visitors[key]);
    return acc;
  }, {});
}

function getAdapter(C, ctx) {
  const {
    adapter = _raw.default
  } = C.adapters.find(({
    test
  }) => test(ctx)) || {};
  return adapter(C, ctx);
}

function createAdapter(_ref) {
  let {
    reader = new _reader.default(),
    writer = new _writer.default(),
    parser,
    visitors
  } = _ref,
      other = _objectWithoutProperties(_ref, ["reader", "writer", "parser", "visitors"]);

  return _objectSpread({}, other, {
    parser,
    reader,
    writer,
    visitors: getDefaultVisitors(visitors),

    runVisitor(resource, path) {
      return (0, _get.default)(this, ['visitors', ...path])(resource);
    }

  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zZXJ2ZXIvaW5zdGFsbGVyL3Jlc291cmNlL2FkYXB0ZXJzL2luZGV4LmpzIl0sIm5hbWVzIjpbImdldERlZmF1bHRWaXNpdG9ycyIsInZpc2l0b3JzIiwidmlzaXRvcktleXMiLCJnZXRTcGxpdFZpc2l0b3IiLCJ2YWx1ZSIsInByZSIsIm5vb3AiLCJwb3N0IiwicmVkdWNlIiwiYWNjIiwia2V5IiwiZ2V0QWRhcHRlciIsIkMiLCJjdHgiLCJhZGFwdGVyIiwiUmF3QWRhcHRlciIsImFkYXB0ZXJzIiwiZmluZCIsInRlc3QiLCJjcmVhdGVBZGFwdGVyIiwicmVhZGVyIiwiUmVhZGVyIiwid3JpdGVyIiwiV3JpdGVyIiwicGFyc2VyIiwib3RoZXIiLCJydW5WaXNpdG9yIiwicmVzb3VyY2UiLCJwYXRoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxrQkFBVCxDQUE0QkMsUUFBUSxHQUFHLEVBQXZDLEVBQTJDO0FBQzFDLFFBQU1DLFdBQVcsR0FBRyxDQUFDLE1BQUQsRUFBUyxPQUFULEVBQWtCLFVBQWxCLEVBQThCLFVBQTlCLEVBQTBDLE9BQTFDLEVBQW1ELFVBQW5ELENBQXBCOztBQUNBLFFBQU1DLGVBQWUsR0FBRyxDQUFDQyxLQUFLLEdBQUcsRUFBVCxNQUFpQjtBQUN4Q0MsSUFBQUEsR0FBRyxFQUFFLENBQUMsT0FBT0QsS0FBUCxLQUFpQixVQUFqQixHQUE4QkEsS0FBOUIsR0FBc0NBLEtBQUssQ0FBQ0MsR0FBN0MsS0FBcURDLGFBRGxCO0FBRXhDQyxJQUFBQSxJQUFJLEVBQUVILEtBQUssQ0FBQ0csSUFBTixJQUFjRDtBQUZvQixHQUFqQixDQUF4Qjs7QUFJQSxTQUFPSixXQUFXLENBQUNNLE1BQVosQ0FBbUIsQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEtBQWM7QUFDdkNELElBQUFBLEdBQUcsQ0FBQ0MsR0FBRCxDQUFILEdBQVdQLGVBQWUsQ0FBQ0YsUUFBUSxDQUFDUyxHQUFELENBQVQsQ0FBMUI7QUFDQSxXQUFPRCxHQUFQO0FBQ0EsR0FITSxFQUdKLEVBSEksQ0FBUDtBQUlBOztBQUVNLFNBQVNFLFVBQVQsQ0FBb0JDLENBQXBCLEVBQXVCQyxHQUF2QixFQUE0QjtBQUNsQyxRQUFNO0FBQUVDLElBQUFBLE9BQU8sR0FBR0M7QUFBWixNQUEyQkgsQ0FBQyxDQUFDSSxRQUFGLENBQVdDLElBQVgsQ0FBZ0IsQ0FBQztBQUFFQyxJQUFBQTtBQUFGLEdBQUQsS0FBY0EsSUFBSSxDQUFDTCxHQUFELENBQWxDLEtBQTRDLEVBQTdFO0FBQ0EsU0FBT0MsT0FBTyxDQUFDRixDQUFELEVBQUlDLEdBQUosQ0FBZDtBQUNBOztBQUVNLFNBQVNNLGFBQVQsT0FNSjtBQUFBLE1BTjJCO0FBQzdCQyxJQUFBQSxNQUFNLEdBQUcsSUFBSUMsZUFBSixFQURvQjtBQUU3QkMsSUFBQUEsTUFBTSxHQUFHLElBQUlDLGVBQUosRUFGb0I7QUFHN0JDLElBQUFBLE1BSDZCO0FBSTdCdkIsSUFBQUE7QUFKNkIsR0FNM0I7QUFBQSxNQURDd0IsS0FDRDs7QUFDRiwyQkFDSUEsS0FESjtBQUVDRCxJQUFBQSxNQUZEO0FBR0NKLElBQUFBLE1BSEQ7QUFJQ0UsSUFBQUEsTUFKRDtBQUtDckIsSUFBQUEsUUFBUSxFQUFFRCxrQkFBa0IsQ0FBQ0MsUUFBRCxDQUw3Qjs7QUFNQ3lCLElBQUFBLFVBQVUsQ0FBQ0MsUUFBRCxFQUFXQyxJQUFYLEVBQWlCO0FBQzFCLGFBQU8sa0JBQUksSUFBSixFQUFVLENBQUMsVUFBRCxFQUFhLEdBQUdBLElBQWhCLENBQVYsRUFBaUNELFFBQWpDLENBQVA7QUFDQTs7QUFSRjtBQVVBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGdldCBmcm9tICcuLi8uLi8uLi8uLi9saWIvaGVscGVycy9nZXQnO1xuaW1wb3J0IG5vb3AgZnJvbSAnLi4vLi4vLi4vLi4vbGliL2hlbHBlcnMvbm9vcCc7XG5pbXBvcnQgUmF3QWRhcHRlciBmcm9tICcuL3Jhdyc7XG5pbXBvcnQgUmVhZGVyIGZyb20gJy4vcmVhZGVyJztcbmltcG9ydCBXcml0ZXIgZnJvbSAnLi93cml0ZXInO1xuXG5mdW5jdGlvbiBnZXREZWZhdWx0VmlzaXRvcnModmlzaXRvcnMgPSB7fSkge1xuXHRjb25zdCB2aXNpdG9yS2V5cyA9IFsnUmVhZCcsICdQYXJzZScsICdSZXF1ZXN0cycsICdHZW5lcmF0ZScsICdXcml0ZScsICdDb21wbGV0ZSddO1xuXHRjb25zdCBnZXRTcGxpdFZpc2l0b3IgPSAodmFsdWUgPSB7fSkgPT4gKHtcblx0XHRwcmU6ICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgPyB2YWx1ZSA6IHZhbHVlLnByZSkgfHwgbm9vcCxcblx0XHRwb3N0OiB2YWx1ZS5wb3N0IHx8IG5vb3Bcblx0fSk7XG5cdHJldHVybiB2aXNpdG9yS2V5cy5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG5cdFx0YWNjW2tleV0gPSBnZXRTcGxpdFZpc2l0b3IodmlzaXRvcnNba2V5XSk7XG5cdFx0cmV0dXJuIGFjYztcblx0fSwge30pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWRhcHRlcihDLCBjdHgpIHtcblx0Y29uc3QgeyBhZGFwdGVyID0gUmF3QWRhcHRlciB9ID0gQy5hZGFwdGVycy5maW5kKCh7IHRlc3QgfSkgPT4gdGVzdChjdHgpKSB8fCB7fTtcblx0cmV0dXJuIGFkYXB0ZXIoQywgY3R4KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUFkYXB0ZXIoe1xuXHRyZWFkZXIgPSBuZXcgUmVhZGVyKCksXG5cdHdyaXRlciA9IG5ldyBXcml0ZXIoKSxcblx0cGFyc2VyLFxuXHR2aXNpdG9ycyxcblx0Li4ub3RoZXJcbn0pIHtcblx0cmV0dXJuIHtcblx0XHQuLi5vdGhlcixcblx0XHRwYXJzZXIsXG5cdFx0cmVhZGVyLFxuXHRcdHdyaXRlcixcblx0XHR2aXNpdG9yczogZ2V0RGVmYXVsdFZpc2l0b3JzKHZpc2l0b3JzKSxcblx0XHRydW5WaXNpdG9yKHJlc291cmNlLCBwYXRoKSB7XG5cdFx0XHRyZXR1cm4gZ2V0KHRoaXMsIFsndmlzaXRvcnMnLCAuLi5wYXRoXSkocmVzb3VyY2UpO1xuXHRcdH1cblx0fTtcbn1cbiJdfQ==
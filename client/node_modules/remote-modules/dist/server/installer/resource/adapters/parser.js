"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _url = _interopRequireDefault(require("url"));

var _stripBom = _interopRequireDefault(require("strip-bom"));

var _memoize = _interopRequireDefault(require("../../../../lib/helpers/memoize"));

var _logger = _interopRequireDefault(require("../../../../lib/logger"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const warnMissingMethod = (0, _memoize.default)(name => {
  _logger.default.warn(`Parser should implement a '${name}' method`);
});

class Parser {
  constructor(methods) {
    _defineProperty(this, "requests", []);

    _defineProperty(this, "sourceMapJSON", null);

    ['buildQuery', 'generate', 'getRequests', 'parse', 'runQuery'].forEach(key => {
      if (typeof methods[key] !== 'function') {
        throw new TypeError(`Parser must implement a '${key}' method`);
      }
    });
    ['compress', 'formatError'].forEach(key => {
      if (typeof methods[key] !== 'function') {
        warnMissingMethod(key);
      }
    });
    this.methods = _objectSpread({
      compress: output => output,
      transform: () => this.ast,
      sourceMappingURL: content => `//# sourceMappingURL=${content}`
    }, methods);
  }

  get resourceURL() {
    return _url.default.resolve(this.sourceRoot, this.sourceFilename);
  }

  getSourceMappingURL(resource) {
    const {
      methods,
      sourceMapJSON,
      resourceURL
    } = this;
    const {
      sourceMaps
    } = resource.options;
    let result = '';

    if (sourceMapJSON && sourceMapJSON.version) {
      if (sourceMaps === 'inline') {
        const base64 = Buffer.from(JSON.stringify(sourceMapJSON)).toString('base64');
        result = `data:application/json;charset=utf-8;base64,${base64}`;
      } else if (sourceMaps !== 'hidden') {
        result = `${resourceURL}.map`;
      }
    }

    return result && `\n${methods.sourceMappingURL(result)}`;
  }

  init(slug, origin, sourceRoot) {
    this.filename = origin;
    this.sourceFilename = slug;
    this.sourceRoot = sourceRoot;
  }

  load(source) {
    const cleanSource = typeof source === 'string' ? (0, _stripBom.default)(source) : source;
    this.source = cleanSource;
    this.output = cleanSource;
    this.ast = this.parse(cleanSource);
  }

  parse(...args) {
    try {
      return this.methods.parse.apply(this, args);
    } catch (err) {
      if (err.name !== 'SyntaxError' || !this.methods.formatError) {
        throw err;
      }

      const formatted = this.methods.formatError.call(this, err);
      throw Object.assign(err, {
        frame: formatted,
        message: formatted,
        originalMessage: err.message
      });
    }
  }

  buildQuery(input) {
    return this.methods.buildQuery.call(this, input);
  }

  runQuery(...args) {
    return this.methods.runQuery.apply(this, args);
  }

  hasNode(...args) {
    return this.runQuery(...args).length > 0;
  }

  getRequests() {
    this.requests = this.methods.getRequests.call(this);
  }

  transform(...args) {
    this.ast = this.methods.transform.apply(this, args);
  }

  generate(...args) {
    this.output = this.methods.generate.apply(this, args);
  }

  compress(...args) {
    this.output = this.methods.compress.apply(this, args);
  }

}

exports.default = Parser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zZXJ2ZXIvaW5zdGFsbGVyL3Jlc291cmNlL2FkYXB0ZXJzL3BhcnNlci5qcyJdLCJuYW1lcyI6WyJ3YXJuTWlzc2luZ01ldGhvZCIsIm5hbWUiLCJsb2dnZXIiLCJ3YXJuIiwiUGFyc2VyIiwiY29uc3RydWN0b3IiLCJtZXRob2RzIiwiZm9yRWFjaCIsImtleSIsIlR5cGVFcnJvciIsImNvbXByZXNzIiwib3V0cHV0IiwidHJhbnNmb3JtIiwiYXN0Iiwic291cmNlTWFwcGluZ1VSTCIsImNvbnRlbnQiLCJyZXNvdXJjZVVSTCIsIlVybCIsInJlc29sdmUiLCJzb3VyY2VSb290Iiwic291cmNlRmlsZW5hbWUiLCJnZXRTb3VyY2VNYXBwaW5nVVJMIiwicmVzb3VyY2UiLCJzb3VyY2VNYXBKU09OIiwic291cmNlTWFwcyIsIm9wdGlvbnMiLCJyZXN1bHQiLCJ2ZXJzaW9uIiwiYmFzZTY0IiwiQnVmZmVyIiwiZnJvbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b1N0cmluZyIsImluaXQiLCJzbHVnIiwib3JpZ2luIiwiZmlsZW5hbWUiLCJsb2FkIiwic291cmNlIiwiY2xlYW5Tb3VyY2UiLCJwYXJzZSIsImFyZ3MiLCJhcHBseSIsImVyciIsImZvcm1hdEVycm9yIiwiZm9ybWF0dGVkIiwiY2FsbCIsIk9iamVjdCIsImFzc2lnbiIsImZyYW1lIiwibWVzc2FnZSIsIm9yaWdpbmFsTWVzc2FnZSIsImJ1aWxkUXVlcnkiLCJpbnB1dCIsInJ1blF1ZXJ5IiwiaGFzTm9kZSIsImxlbmd0aCIsImdldFJlcXVlc3RzIiwicmVxdWVzdHMiLCJnZW5lcmF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLGlCQUFpQixHQUFHLHNCQUFRQyxJQUFJLElBQUk7QUFDekNDLGtCQUFPQyxJQUFQLENBQWEsOEJBQTZCRixJQUFLLFVBQS9DO0FBQ0EsQ0FGeUIsQ0FBMUI7O0FBSWUs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LFNBQUs3QixHQUFMLEdBQVcsS0FBS1AsT0FBTCxDQUFhTSxTQUFiLENBQXVCK0IsS0FBdkIsQ0FBNkIsSUFBN0IsRUFBbUNELElBQW5DLENBQVg7QUFDQTs7QUFFRGtCLEVBQUFBLFFBQVEsQ0FBQyxHQUFHbEIsSUFBSixFQUFVO0FBQ2pCLFNBQUsvQixNQUFMLEdBQWMsS0FBS0wsT0FBTCxDQUFhc0QsUUFBYixDQUFzQmpCLEtBQXRCLENBQTRCLElBQTVCLEVBQWtDRCxJQUFsQyxDQUFkO0FBQ0E7O0FBRURoQyxFQUFBQSxRQUFRLENBQUMsR0FBR2dDLElBQUosRUFBVTtBQUNqQixTQUFLL0IsTUFBTCxHQUFjLEtBQUtMLE9BQUwsQ0FBYUksUUFBYixDQUFzQmlDLEtBQXRCLENBQTRCLElBQTVCLEVBQWtDRCxJQUFsQyxDQUFkO0FBQ0E7O0FBcEcwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBVcmwgZnJvbSAndXJsJztcblxuaW1wb3J0IHN0cmlwQk9NIGZyb20gJ3N0cmlwLWJvbSc7XG5cbmltcG9ydCBtZW1vaXplIGZyb20gJy4uLy4uLy4uLy4uL2xpYi9oZWxwZXJzL21lbW9pemUnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuLi8uLi8uLi8uLi9saWIvbG9nZ2VyJztcblxuY29uc3Qgd2Fybk1pc3NpbmdNZXRob2QgPSBtZW1vaXplKG5hbWUgPT4ge1xuXHRsb2dnZXIud2FybihgUGFyc2VyIHNob3VsZCBpbXBsZW1lbnQgYSAnJHtuYW1lfScgbWV0aG9kYCk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFyc2VyIHtcblx0Y29uc3RydWN0b3IobWV0aG9kcykge1xuXHRcdFsnYnVpbGRRdWVyeScsICdnZW5lcmF0ZScsICdnZXRSZXF1ZXN0cycsICdwYXJzZScsICdydW5RdWVyeSddLmZvckVhY2goa2V5ID0+IHtcblx0XHRcdGlmICh0eXBlb2YgbWV0aG9kc1trZXldICE9PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoYFBhcnNlciBtdXN0IGltcGxlbWVudCBhICcke2tleX0nIG1ldGhvZGApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Wydjb21wcmVzcycsICdmb3JtYXRFcnJvciddLmZvckVhY2goa2V5ID0+IHtcblx0XHRcdGlmICh0eXBlb2YgbWV0aG9kc1trZXldICE9PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHdhcm5NaXNzaW5nTWV0aG9kKGtleSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLm1ldGhvZHMgPSB7XG5cdFx0XHRjb21wcmVzczogb3V0cHV0ID0+IG91dHB1dCxcblx0XHRcdHRyYW5zZm9ybTogKCkgPT4gdGhpcy5hc3QsXG5cdFx0XHRzb3VyY2VNYXBwaW5nVVJMOiBjb250ZW50ID0+IGAvLyMgc291cmNlTWFwcGluZ1VSTD0ke2NvbnRlbnR9YCxcblx0XHRcdC4uLm1ldGhvZHNcblx0XHR9O1xuXHR9XG5cblx0cmVxdWVzdHMgPSBbXTtcblxuXHRzb3VyY2VNYXBKU09OID0gbnVsbDtcblxuXHRnZXQgcmVzb3VyY2VVUkwoKSB7XG5cdFx0cmV0dXJuIFVybC5yZXNvbHZlKHRoaXMuc291cmNlUm9vdCwgdGhpcy5zb3VyY2VGaWxlbmFtZSk7XG5cdH1cblxuXHRnZXRTb3VyY2VNYXBwaW5nVVJMKHJlc291cmNlKSB7XG5cdFx0Y29uc3QgeyBtZXRob2RzLCBzb3VyY2VNYXBKU09OLCByZXNvdXJjZVVSTCB9ID0gdGhpcztcblx0XHRjb25zdCB7IHNvdXJjZU1hcHMgfSA9IHJlc291cmNlLm9wdGlvbnM7XG5cdFx0bGV0IHJlc3VsdCA9ICcnO1xuXHRcdGlmIChzb3VyY2VNYXBKU09OICYmIHNvdXJjZU1hcEpTT04udmVyc2lvbikge1xuXHRcdFx0aWYgKHNvdXJjZU1hcHMgPT09ICdpbmxpbmUnKSB7XG5cdFx0XHRcdGNvbnN0IGJhc2U2NCA9IEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KHNvdXJjZU1hcEpTT04pKS50b1N0cmluZygnYmFzZTY0Jyk7XG5cdFx0XHRcdHJlc3VsdCA9IGBkYXRhOmFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtODtiYXNlNjQsJHtiYXNlNjR9YDtcblx0XHRcdH0gZWxzZSBpZiAoc291cmNlTWFwcyAhPT0gJ2hpZGRlbicpIHtcblx0XHRcdFx0cmVzdWx0ID0gYCR7cmVzb3VyY2VVUkx9Lm1hcGA7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQgJiYgYFxcbiR7bWV0aG9kcy5zb3VyY2VNYXBwaW5nVVJMKHJlc3VsdCl9YDtcblx0fVxuXG5cdGluaXQoc2x1Zywgb3JpZ2luLCBzb3VyY2VSb290KSB7XG5cdFx0dGhpcy5maWxlbmFtZSA9IG9yaWdpbjtcblx0XHR0aGlzLnNvdXJjZUZpbGVuYW1lID0gc2x1Zztcblx0XHR0aGlzLnNvdXJjZVJvb3QgPSBzb3VyY2VSb290O1xuXHR9XG5cblx0bG9hZChzb3VyY2UpIHtcblx0XHRjb25zdCBjbGVhblNvdXJjZSA9IHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnID8gc3RyaXBCT00oc291cmNlKSA6IHNvdXJjZTtcblx0XHR0aGlzLnNvdXJjZSA9IGNsZWFuU291cmNlO1xuXHRcdHRoaXMub3V0cHV0ID0gY2xlYW5Tb3VyY2U7XG5cdFx0dGhpcy5hc3QgPSB0aGlzLnBhcnNlKGNsZWFuU291cmNlKTtcblx0fVxuXG5cdHBhcnNlKC4uLmFyZ3MpIHtcblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIHRoaXMubWV0aG9kcy5wYXJzZS5hcHBseSh0aGlzLCBhcmdzKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdGlmIChlcnIubmFtZSAhPT0gJ1N5bnRheEVycm9yJyB8fCAhdGhpcy5tZXRob2RzLmZvcm1hdEVycm9yKSB7XG5cdFx0XHRcdHRocm93IGVycjtcblx0XHRcdH1cblx0XHRcdGNvbnN0IGZvcm1hdHRlZCA9IHRoaXMubWV0aG9kcy5mb3JtYXRFcnJvci5jYWxsKHRoaXMsIGVycik7XG5cdFx0XHR0aHJvdyBPYmplY3QuYXNzaWduKGVyciwge1xuXHRcdFx0XHRmcmFtZTogZm9ybWF0dGVkLFxuXHRcdFx0XHRtZXNzYWdlOiBmb3JtYXR0ZWQsXG5cdFx0XHRcdG9yaWdpbmFsTWVzc2FnZTogZXJyLm1lc3NhZ2Vcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdGJ1aWxkUXVlcnkoaW5wdXQpIHtcblx0XHRyZXR1cm4gdGhpcy5tZXRob2RzLmJ1aWxkUXVlcnkuY2FsbCh0aGlzLCBpbnB1dCk7XG5cdH1cblxuXHRydW5RdWVyeSguLi5hcmdzKSB7XG5cdFx0cmV0dXJuIHRoaXMubWV0aG9kcy5ydW5RdWVyeS5hcHBseSh0aGlzLCBhcmdzKTtcblx0fVxuXG5cdGhhc05vZGUoLi4uYXJncykge1xuXHRcdHJldHVybiB0aGlzLnJ1blF1ZXJ5KC4uLmFyZ3MpLmxlbmd0aCA+IDA7XG5cdH1cblxuXHRnZXRSZXF1ZXN0cygpIHtcblx0XHR0aGlzLnJlcXVlc3RzID0gdGhpcy5tZXRob2RzLmdldFJlcXVlc3RzLmNhbGwodGhpcyk7XG5cdH1cblxuXHR0cmFuc2Zvcm0oLi4uYXJncykge1xuXHRcdHRoaXMuYXN0ID0gdGhpcy5tZXRob2RzLnRyYW5zZm9ybS5hcHBseSh0aGlzLCBhcmdzKTtcblx0fVxuXG5cdGdlbmVyYXRlKC4uLmFyZ3MpIHtcblx0XHR0aGlzLm91dHB1dCA9IHRoaXMubWV0aG9kcy5nZW5lcmF0ZS5hcHBseSh0aGlzLCBhcmdzKTtcblx0fVxuXG5cdGNvbXByZXNzKC4uLmFyZ3MpIHtcblx0XHR0aGlzLm91dHB1dCA9IHRoaXMubWV0aG9kcy5jb21wcmVzcy5hcHBseSh0aGlzLCBhcmdzKTtcblx0fVxufVxuIl19
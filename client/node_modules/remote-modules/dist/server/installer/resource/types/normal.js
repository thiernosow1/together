"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _path = _interopRequireDefault(require("path"));

var _url = _interopRequireDefault(require("url"));

var _objectHash = _interopRequireDefault(require("object-hash"));

var _context = require("../../context");

var _helpers = require("../../../../lib/helpers");

var _fs = require("../../../../lib/helpers/fs");

var _defineProperties = _interopRequireDefault(require("../../../../lib/helpers/defineProperties"));

var _get = _interopRequireDefault(require("../../../../lib/helpers/get"));

var _noop = _interopRequireDefault(require("../../../../lib/helpers/noop"));

var _once = _interopRequireDefault(require("../../../../lib/helpers/once"));

var _pick = _interopRequireDefault(require("../../../../lib/helpers/pick"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class NormalResource {
  constructor({
    ctx,
    adapter,
    resourceFactory,
    contextFactory,
    unionFactory,
    logger,
    options: _options
  }) {
    _defineProperty(this, "size", -1);

    _defineProperty(this, "sourceChecksum", null);

    _defineProperty(this, "optionsChecksum", null);

    _defineProperty(this, "getOptionsChecksum", (0, _once.default)(() => {
      const {
        define,
        provide
      } = this.mutations;

      const summableOptions = _objectSpread({}, (0, _helpers.omit)(this.options, ['watch']), {
        define: (0, _helpers.mapObject)(define, (_, key) => this.options.define[key]),
        provide: (0, _helpers.mapObject)(provide, (_, key) => this.options.provide[key])
      });

      return (0, _objectHash.default)(summableOptions, {
        algorithm: 'md5'
      });
    }));

    _defineProperty(this, "getSourceChecksum", (0, _once.default)(async () => {
      const stats = await (0, _fs.statAsync)(this.origin);
      const pickedStats = (0, _pick.default)(stats, ['ctime', 'mtime', 'ino', 'size']);
      return (0, _objectHash.default)(pickedStats, {
        algorithm: 'md5'
      });
    }));

    _defineProperty(this, "getBabelrc", (0, _once.default)(() => {
      let babelrc = (0, _get.default)(this, ['options', 'babel', 'babelrc']);

      if (babelrc !== false && !this.isInstalledPackage()) {
        babelrc = this.contextFactory.safeResolve('.babelrc', this.getOriginDir());
      }

      return babelrc || undefined;
    }));

    _defineProperty(this, "getBabelOptions", (() => {
      let called;
      return (0, _defineProperties.default)(() => {
        // Make sure babel options are only applied once
        const options = called ? {} : _objectSpread({
          extends: this.getBabelrc()
        }, this.options.babel);
        called = true;
        return options;
      }, {
        clear: () => {
          called = false;
        }
      });
    })());

    _defineProperty(this, "hydrate", (0, _once.default)((_ref) => {
      let {
        resolverPaths
      } = _ref,
          other = _objectWithoutProperties(_ref, ["resolverPaths"]);

      const source = Array.isArray(other.source) ? Buffer.from(other.source) : other.source;
      const output = (Array.isArray(other.output) ? Buffer.from(other.output) : other.output) || source;
      Object.assign(this, (0, _helpers.omit)(other, ['output', 'source', 'requests']), {
        output,
        source
      });
      resolverPaths.forEach(rel => {
        this.resolverPaths.add(_path.default.join(this.options.rootDir, rel));
      });
      return this;
    }));

    let _source;

    (0, _defineProperties.default)(this, {
      resourceFactory,
      contextFactory,
      unionFactory,
      logger,
      options: _options,
      adapter,
      dependencies: new Map(),
      dependents: new Map(),
      requests: new Map(),
      resolverPaths: new Set(),
      async: {
        enumerable: true,
        writable: true
      },
      union: {
        writable: true
      },
      dirty: {
        value: false,
        writable: true
      },
      error: {
        writable: true
      },
      getBabelrc: {
        writable: true
      },
      getSourceChecksum: {
        writable: true
      },
      getOptionsChecksum: {
        writable: true
      },
      hydrate: {
        writable: true
      },
      index: {
        enumerable: true,
        writable: true
      },
      loaded: {
        value: false,
        writable: true
      },
      mutations: {
        value: {
          define: {},
          provide: {}
        },
        writable: true
      },
      output: {
        writable: true
      },
      failed: {
        get: () => resourceFactory.failed,
        set: value => {
          // eslint-disable-next-line no-param-reassign
          resourceFactory.failed = value;
        }
      },
      source: {
        get: () => _source,
        set: value => {
          if (value !== undefined) {
            _source = value;
            this.size = Buffer.byteLength(value);
          }
        }
      },
      isNormal: () => resourceFactory.isNormal(this),
      isExternal: () => resourceFactory.isExternal(this),
      isNull: () => resourceFactory.isNull(this),
      isInstalledPackage: () => contextFactory.isInstalledPackage(this.slug)
    });
    Object.assign(this, (0, _pick.default)(ctx, ['error', 'moduleId', 'origin', 'packageId', 'pid', 'slug']));
  }

  isOrphaned() {
    return this.dependents.size === 0 && !this.sameAs(this.resourceFactory());
  }
  /**
   * Sets whether the resource was requested asynchronously.
   * True if ALL requests are async, false otherwise.
   * Can only change from:
   *	1. undefined => true
   *	2. undefined => false
   *	3. true => false
   */


  setAsync(value) {
    if (this.async === undefined || this.async && !value) {
      this.async = Boolean(value);
    }
  }

  addToUnion(id, options) {
    if ((0, _get.default)(this, ['union', 'id']) !== id) {
      this.removeFromUnion();
      this.union = this.unionFactory(id, {
        options: _objectSpread({}, this.options, options),
        writer: this.adapter.writer
      });
      this.union.add(this);
    }
  }

  removeFromUnion() {
    if (this.union) {
      this.union.delete(this);
      this.union = null;
    }
  }

  markDirty(history = new Set([this.pid])) {
    this.dirty = true;
    this.loaded = false;
    this.sourceChecksum = null;
    this.getSourceChecksum.clear();
    this.getBabelOptions.clear();
    this.dependents.forEach(resource => {
      if (!history.has(resource.pid)) {
        history.add(resource.pid);
        resource.markDirty(history);
      }
    });
    this.dependencies.forEach(resource => {
      // eslint-disable-next-line no-param-reassign
      resource.index = undefined;
    });
    this.contextFactory.uncache({
      origin: this.origin
    });

    if (this.union) {
      this.union.reset(this);
    }
  }

  getResolverPaths() {
    return [this.getOriginDir(), ...this.resolverPaths];
  }

  getMeta() {
    return _objectSpread({}, (0, _pick.default)(this, ['index', 'moduleId', 'pid']), {
      outputSlug: this.getOutputSlug(),
      type: this.adapter.outputType
    });
  }

  getOriginDir() {
    return _path.default.dirname(this.origin);
  }

  getAssetId() {
    return this.union ? this.union.getAssetId(this) : this.getOutputSlug();
  }

  getOutputSlug() {
    const {
      adapter,
      slug
    } = this;
    const {
      extension
    } = adapter.writer;

    const ext = _path.default.extname(slug);

    return ext && extension && !slug.endsWith(extension) ? `${slug}${extension}` : slug;
  }

  getOutputPath() {
    return (0, _context.slugToAbsolutePath)(this.options.outputDir, this.getOutputSlug());
  }

  getOutputDir() {
    return _path.default.dirname(this.getOutputPath());
  }

  isPristineOptions() {
    return this.optionsChecksum === this.getOptionsChecksum();
  }

  async isPristineSource() {
    return this.sourceChecksum === (await this.getSourceChecksum());
  }

  isPristineSelf() {
    return !this.dirty && this.isPristineOptions() && this.isPristineSource();
  }

  async isPristine() {
    let result;

    for (const resource of [this, ...this.getDeepDependencySet(undefined, true)]) {
      // It turns out this is ~2x faster than Promise.all
      // eslint-disable-next-line no-await-in-loop
      result = await resource.isPristineSelf();

      if (!result) {
        break;
      }
    }

    return result;
  }

  async read() {
    if (!(await this.isPristineSource())) {
      this.source = await this.adapter.reader.apply(this);
    }

    this.sourceChecksum = await this.getSourceChecksum();
  }

  write() {
    return this.union.write();
  }

  async runVisitor(name, fn = _noop.default) {
    if (!this.failed) {
      try {
        await this.adapter.runVisitor(this, [name, 'pre']);
        await fn();
        await this.adapter.runVisitor(this, [name, 'post']);
      } catch (err) {
        this.failed = true;
        this.logger.error(`Resource '${this.moduleId}' failed on visitor '${name}'`);
        throw err;
      }
    }
  }

  async traverse(interceptor, history = new Set([this.pid])) {
    const requestProcessors = [];
    let shouldWrite;

    if (!this.union) {
      this.addToUnion(this.slug);
    }

    if (await this.isPristine()) {
      this.logger.debug(`Loaded '${this.moduleId}' from cache`);
      this.dependencies.forEach(resource => {
        if (!history.has(resource.pid)) {
          history.add(resource.pid);
          requestProcessors.push(() => resource.traverse(interceptor, history));
        }
      }); // eslint-disable-next-line no-cond-assign
    } else if (shouldWrite = await interceptor(this)) {
      const {
        adapter
      } = this;
      this.logger.info(`Traverse '${this.moduleId}'`);
      this.optionsChecksum = this.getOptionsChecksum();
      adapter.parser.init(this.slug, this.origin, _url.default.resolve(`${this.options.server.uri}/`, '_/'));
      await this.runVisitor('Read', () => this.read());
      this.output = this.source;
      await this.runVisitor('Parse', () => {
        adapter.parser.load(this.output);
      });
      await this.runVisitor('Requests', async () => {
        const removedDependencies = new Map([...this.dependencies]);
        this.dependencies.clear();
        this.requests.clear();
        adapter.parser.getRequests();
        adapter.parser.requests.forEach(requestObject => {
          const resource = this.resourceFactory(requestObject, this);
          this.addDependency(requestObject, resource);

          if (!history.has(resource.pid)) {
            history.add(resource.pid);
            requestProcessors.push(() => resource.traverse(interceptor, history));
          }

          removedDependencies.delete(resource.pid);
        }); // Clean up removed resource dependents

        removedDependencies.forEach(resource => {
          this.removeDependency(resource);
        });
      });
      await this.runVisitor('Generate', () => {
        this.generate();
      });
      this.output = adapter.parser.output;
    }

    if (requestProcessors.length) {
      await Promise.all(requestProcessors.map(fn => fn()));
    }

    this.loaded = true;
    this.dirty = false;

    if (shouldWrite) {
      await this.runVisitor('Write', () => this.write());
    }
  }

  applyMutations() {
    // Reset mutations objects
    this.mutations.define = {};
    this.mutations.provide = {};
    Object.entries(this.options.define).forEach(([key, value]) => {
      this.define(key, value);
    });
    Object.entries(this.options.provide).forEach(([key, value]) => {
      this.provide(key, value);
    });
    this.getOptionsChecksum.clear();
    this.optionsChecksum = this.getOptionsChecksum();
  }

  define(key, value) {
    const query = `
			// Program [(
				// ${this.adapter.parser.buildQuery(key)}
			) && !((
				// AssignmentExpression [
					/:left ${this.adapter.parser.buildQuery(key)}
				]
			) || (
				// ImportDeclaration // ${this.adapter.parser.buildQuery(key)}
			) || ${// FIXME: why doesn't this work without '... || false'?
    false})]
		`;

    if (this.adapter.parser.hasNode(query)) {
      this.mutations.define[key] = value;
    }
  }

  provide(key, value) {
    const {
      adapter,
      mutations
    } = this; // Make sure the provide key is referenced but not declared or assigned

    const query = `
			// Program [(
				// ${adapter.parser.buildQuery(key)}
			) && !((
				// VariableDeclarator [
					/:id ${adapter.parser.buildQuery(key)}
				]
			) || (
				// FunctionDeclaration [
					/:id ${adapter.parser.buildQuery(key)}
				]
			) || (
				// AssignmentExpression [
					/:left ${adapter.parser.buildQuery(key)}
				]
			) || (
				// ImportDeclaration // ${adapter.parser.buildQuery(key)}
			))]
		`;

    if (adapter.parser.hasNode(query)) {
      const ast = adapter.parser.parse(String(value), {
        allowImportExportEverywhere: true,
        allowReturnOutsideFunction: true,
        allowSuperOutsideMethod: true
      });
      const [importDeclaration] = adapter.parser.runQuery('// ImportDeclaration', ast);

      if (importDeclaration && !this.sameAs(importDeclaration.source.value)) {
        mutations.provide[key] = (0, _defineProperties.default)(importDeclaration, {
          toJSON: () => value
        });
      } else {
        mutations.provide[key] = String(value);
      }
    }
  }

  transform(options) {
    return this.adapter.parser.transform(this, options);
  }

  generate(options) {
    return this.adapter.parser.generate(this, options);
  }

  compress(options) {
    return this.adapter.parser.compress(this, options);
  }

  addDependency(requestObject, resource) {
    const {
      dependencies,
      requests
    } = this;

    if (!requests.has(requestObject.key)) {
      requests.set(requestObject.key, _objectSpread({}, requestObject, {
        pid: resource.pid
      }));
    }

    if (!dependencies.has(resource.pid)) {
      dependencies.set(resource.pid, resource);
    }

    if (!resource.dependents.has(this.pid)) {
      resource.dependents.set(this.pid, this);
    }
  }

  removeDependency(resource) {
    resource.dependents.delete(this.pid);

    if (resource.isOrphaned()) {
      if (this.union) {
        this.union.delete(resource);
      }

      resource.dependencies.forEach(dependency => {
        resource.removeDependency(dependency);
      });
    }
  }

  sameAs(request) {
    return Boolean(request && this.resourceFactory(request, this).pid === this.pid);
  }

  dependencyOf(request, history = new Set([this.pid])) {
    const resource = this.resourceFactory(request, this);
    let result = this.dependents.has(resource.pid);

    if (!result) {
      for (const [, dependent] of this.dependents) {
        if (!history.has(dependent.pid)) {
          history.add(dependent.pid);
          result = dependent.dependencyOf(resource, history);

          if (result) {
            break;
          }
        }
      }
    }

    return result;
  }

  getDeepDependencySet(filter, dangerous, acc = new Set()) {
    if (!dangerous && !this.loaded) {
      throw new Error('Cannot guarantee a full dependency set before the entire tree is loaded');
    }

    const childDependencyGetters = [];

    for (const [, request] of this.requests) {
      const resource = this.dependencies.get(request.pid);

      if (!filter || filter(resource, request)) {
        if (acc.has(resource)) {
          acc.delete(resource);
        } else {
          childDependencyGetters.push(() => resource.getDeepDependencySet(filter, dangerous, acc));
        }

        acc.add(resource);
      }
    }

    for (const fn of childDependencyGetters) {
      fn();
    }

    return acc;
  }

  getDependenciesByRequest(filter = () => true) {
    const resources = new Map();

    for (const [, request] of this.requests) {
      const resource = this.dependencies.get(request.pid);

      if (filter(resource)) {
        resources.set(request.value, resource);
      }
    }

    return resources;
  }

  getRequestMap(filter) {
    const requestMap = this.getDependenciesByRequest(filter);

    for (const [key, resource] of requestMap) {
      switch (true) {
        case resource.isExternal():
          requestMap.set(key, resource.moduleId);
          break;

        case resource.isNull():
          requestMap.set(key, null);
          break;

        default:
          requestMap.set(key, resource.pid);
          break;
      }
    }

    return requestMap;
  }

  toJSON() {
    const {
      contextFactory,
      mutations,
      resolverPaths
    } = this;
    const requests = [...this.requests.values()].map(req => (0, _helpers.omit)(req, ['pid']));
    const source = Buffer.isBuffer(this.source) ? Array.from(this.source) : this.source;
    const output = this.output !== this.source && (Buffer.isBuffer(this.output) ? Array.from(this.output) : this.output) || undefined;
    return _objectSpread({}, (0, _helpers.pickBy)(this, _helpers.isPrimitive), {
      origin: undefined,
      resolverPaths: [...resolverPaths].map(dir => contextFactory.getSlug(dir)),
      mutations,
      requests,
      source,
      output
    });
  }

}

exports.default = NormalResource;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zZXJ2ZXIvaW5zdGFsbGVyL3Jlc291cmNlL3R5cGVzL25vcm1hbC5qcyJdLCJuYW1lcyI6WyJOb3JtYWxSZXNvdXJjZSIsImNvbnN0cnVjdG9yIiwiY3R4IiwiYWRhcHRlciIsInJlc291cmNlRmFjdG9yeSIsImNvbnRleHRGYWN0b3J5IiwidW5pb25GYWN0b3J5IiwibG9nZ2VyIiwib3B0aW9ucyIsImRlZmluZSIsInByb3ZpZGUiLCJtdXRhdGlvbnMiLCJzdW1tYWJsZU9wdGlvbnMiLCJfIiwia2V5IiwiYWxnb3JpdGhtIiwic3RhdHMiLCJvcmlnaW4iLCJwaWNrZWRTdGF0cyIsImJhYmVscmMiLCJpc0luc3RhbGxlZFBhY2thZ2UiLCJzYWZlUmVzb2x2ZSIsImdldE9yaWdpbkRpciIsInVuZGVmaW5lZCIsImNhbGxlZCIsImV4dGVuZHMiLCJnZXRCYWJlbHJjIiwiYmFiZWwiLCJjbGVhciIsInJlc29sdmVyUGF0aHMiLCJvdGhlciIsInNvdXJjZSIsIkFycmF5IiwiaXNBcnJheSIsIkJ1ZmZlciIsImZyb20iLCJvdXRwdXQiLCJPYmplY3QiLCJhc3NpZ24iLCJmb3JFYWNoIiwicmVsIiwiYWRkIiwiUGF0aCIsImpvaW4iLCJyb290RGlyIiwiZGVwZW5kZW5jaWVzIiwiTWFwIiwiZGVwZW5kZW50cyIsInJlcXVlc3RzIiwiU2V0IiwiYXN5bmMiLCJlbnVtZXJhYmxlIiwid3JpdGFibGUiLCJ1bmlvbiIsImRpcnR5IiwidmFsdWUiLCJlcnJvciIsImdldFNvdXJjZUNoZWNrc3VtIiwiZ2V0T3B0aW9uc0NoZWNrc3VtIiwiaHlkcmF0ZSIsImluZGV4IiwibG9hZGVkIiwiZmFpbGVkIiwiZ2V0Iiwic2V0Iiwic2l6ZSIsImJ5dGVMZW5ndGgiLCJpc05vcm1hbCIsImlzRXh0ZXJuYWwiLCJpc051bGwiLCJzbHVnIiwiaXNPcnBoYW5lZCIsInNhbWVBcyIsInNldEFzeW5jIiwiQm9vbGVhbiIsImFkZFRvVW5pb24iLCJpZCIsInJlbW92ZUZyb21VbmlvbiIsIndyaXRlciIsImRlbGV0ZSIsIm1hcmtEaXJ0eSIsImhpc3RvcnkiLCJwaWQiLCJzb3VyY2VDaGVja3N1bSIsImdldEJhYmVsT3B0aW9ucyIsInJlc291cmNlIiwiaGFzIiwidW5jYWNoZSIsInJlc2V0IiwiZ2V0UmVzb2x2ZXJQYXRocyIsImdldE1ldGEiLCJvdXRwdXRTbHVnIiwiZ2V0T3V0cHV0U2x1ZyIsInR5cGUiLCJvdXRwdXRUeXBlIiwiZGlybmFtZSIsImdldEFzc2V0SWQiLCJleHRlbnNpb24iLCJleHQiLCJleHRuYW1lIiwiZW5kc1dpdGgiLCJnZXRPdXRwdXRQYXRoIiwib3V0cHV0RGlyIiwiZ2V0T3V0cHV0RGlyIiwiaXNQcmlzdGluZU9wdGlvbnMiLCJvcHRpb25zQ2hlY2tzdW0iLCJpc1ByaXN0aW5lU291cmNlIiwiaXNQcmlzdGluZVNlbGYiLCJpc1ByaXN0aW5lIiwicmVzdWx0IiwiZ2V0RGVlcERlcGVuZGVuY3lTZXQiLCJyZWFkIiwicmVhZGVyIiwiYXBwbHkiLCJ3cml0ZSIsInJ1blZpc2l0b3IiLCJuYW1lIiwiZm4iLCJub29wIiwiZXJyIiwibW9kdWxlSWQiLCJ0cmF2ZXJzZSIsImludGVyY2VwdG9yIiwicmVxdWVzdFByb2Nlc3NvcnMiLCJzaG91bGRXcml0ZSIsImRlYnVnIiwicHVzaCIsImluZm8iLCJwYXJzZXIiLCJpbml0IiwiVXJsIiwicmVzb2x2ZSIsInNlcnZlciIsInVyaSIsImxvYWQiLCJyZW1vdmVkRGVwZW5kZW5jaWVzIiwiZ2V0UmVxdWVzdHMiLCJyZXF1ZXN0T2JqZWN0IiwiYWRkRGVwZW5kZW5jeSIsInJlbW92ZURlcGVuZGVuY3kiLCJnZW5lcmF0ZSIsImxlbmd0aCIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJhcHBseU11dGF0aW9ucyIsImVudHJpZXMiLCJxdWVyeSIsImJ1aWxkUXVlcnkiLCJoYXNOb2RlIiwiYXN0IiwicGFyc2UiLCJTdHJpbmciLCJhbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmUiLCJhbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbiIsImFsbG93U3VwZXJPdXRzaWRlTWV0aG9kIiwiaW1wb3J0RGVjbGFyYXRpb24iLCJydW5RdWVyeSIsInRvSlNPTiIsInRyYW5zZm9ybSIsImNvbXByZXNzIiwiZGVwZW5kZW5jeSIsInJlcXVlc3QiLCJkZXBlbmRlbmN5T2YiLCJkZXBlbmRlbnQiLCJmaWx0ZXIiLCJkYW5nZXJvdXMiLCJhY2MiLCJFcnJvciIsImNoaWxkRGVwZW5kZW5jeUdldHRlcnMiLCJnZXREZXBlbmRlbmNpZXNCeVJlcXVlc3QiLCJyZXNvdXJjZXMiLCJnZXRSZXF1ZXN0TWFwIiwicmVxdWVzdE1hcCIsInZhbHVlcyIsInJlcSIsImlzQnVmZmVyIiwiaXNQcmltaXRpdmUiLCJkaXIiLCJnZXRTbHVnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUVlLE1BQU1BLGNBQU4sQ0FBcUI7QUFDbkNDLEVBQUFBLFdBQVcsQ0FBQztBQUFFQyxJQUFBQSxHQUFGO0FBQU9DLElBQUFBLE9BQVA7QUFBZ0JDLElBQUFBLGVBQWhCO0FBQWlDQyxJQUFBQSxjQUFqQztBQUFpREMsSUFBQUEsWUFBakQ7QUFBK0RDLElBQUFBLE1BQS9EO0FBQXVFQyxJQUFBQSxPQUFPLEVBQVBBO0FBQXZFLEdBQUQsRUFBbUY7QUFBQSxrQ0FtRnZGLENBQUMsQ0FuRnNGOztBQUFBLDRDQXFGN0UsSUFyRjZFOztBQUFBLDZDQXVGNUUsSUF2RjRFOztBQUFBLGdEQXlGekUsbUJBQUssTUFBTTtBQUMvQixZQUFNO0FBQUVDLFFBQUFBLE1BQUY7QUFBVUMsUUFBQUE7QUFBVixVQUFzQixLQUFLQyxTQUFqQzs7QUFDQSxZQUFNQyxlQUFlLHFCQUNqQixtQkFBSyxLQUFLSixPQUFWLEVBQW1CLENBQUMsT0FBRCxDQUFuQixDQURpQjtBQUVwQkMsUUFBQUEsTUFBTSxFQUFFLHdCQUFVQSxNQUFWLEVBQWtC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QUFoQixDQUEvQixHQUF5RCxLQUFLQSxNQUE3RTtBQUNBLFVBQU1LLE1BQU0sR0FDVixLQUFLQSxNQUFMLEtBQWdCLEtBQUtMLE1BQXJCLEtBQ0NHLE1BQU0sQ0FBQzhJLFFBQVAsQ0FBZ0IsS0FBSzVJLE1BQXJCLElBQStCSixLQUFLLENBQUNHLElBQU4sQ0FBVyxLQUFLQyxNQUFoQixDQUEvQixHQUF5RCxLQUFLQSxNQUQvRCxDQUFELElBRUFiLFNBSEQ7QUFJQSw2QkFDSSxxQkFBTyxJQUFQLEVBQWEwSixvQkFBYixDQURKO0FBRUNoSyxNQUFBQSxNQUFNLEVBQUVNLFNBRlQ7QUFHQ00sTUFBQUEsYUFBYSxFQUFFLENBQUMsR0FBR0EsYUFBSixFQUFtQm1ILEdBQW5CLENBQXVCa0MsR0FBRyxJQUFJN0ssY0FBYyxDQUFDOEssT0FBZixDQUF1QkQsR0FBdkIsQ0FBOUIsQ0FIaEI7QUFJQ3ZLLE1BQUFBLFNBSkQ7QUFLQ3FDLE1BQUFBLFFBTEQ7QUFNQ2pCLE1BQUFBLE1BTkQ7QUFPQ0ssTUFBQUE7QUFQRDtBQVNBOztBQTNqQmtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgVXJsIGZyb20gJ3VybCc7XG5cbmltcG9ydCBoYXNoIGZyb20gJ29iamVjdC1oYXNoJztcblxuaW1wb3J0IHsgc2x1Z1RvQWJzb2x1dGVQYXRoIH0gZnJvbSAnLi4vLi4vY29udGV4dCc7XG5pbXBvcnQgeyBpc1ByaW1pdGl2ZSwgbWFwT2JqZWN0LCBvbWl0LCBwaWNrQnkgfSBmcm9tICcuLi8uLi8uLi8uLi9saWIvaGVscGVycyc7XG5pbXBvcnQgeyBzdGF0QXN5bmMgfSBmcm9tICcuLi8uLi8uLi8uLi9saWIvaGVscGVycy9mcyc7XG5pbXBvcnQgZGVmaW5lUHJvcGVydGllcyBmcm9tICcuLi8uLi8uLi8uLi9saWIvaGVscGVycy9kZWZpbmVQcm9wZXJ0aWVzJztcbmltcG9ydCBnZXQgZnJvbSAnLi4vLi4vLi4vLi4vbGliL2hlbHBlcnMvZ2V0JztcbmltcG9ydCBub29wIGZyb20gJy4uLy4uLy4uLy4uL2xpYi9oZWxwZXJzL25vb3AnO1xuaW1wb3J0IG9uY2UgZnJvbSAnLi4vLi4vLi4vLi4vbGliL2hlbHBlcnMvb25jZSc7XG5pbXBvcnQgcGljayBmcm9tICcuLi8uLi8uLi8uLi9saWIvaGVscGVycy9waWNrJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTm9ybWFsUmVzb3VyY2Uge1xuXHRjb25zdHJ1Y3Rvcih7IGN0eCwgYWRhcHRlciwgcmVzb3VyY2VGYWN0b3J5LCBjb250ZXh0RmFjdG9yeSwgdW5pb25GYWN0b3J5LCBsb2dnZXIsIG9wdGlvbnMgfSkge1xuXHRcdGxldCBzb3VyY2U7XG5cblx0XHRkZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcblx0XHRcdHJlc291cmNlRmFjdG9yeSxcblx0XHRcdGNvbnRleHRGYWN0b3J5LFxuXHRcdFx0dW5pb25GYWN0b3J5LFxuXHRcdFx0bG9nZ2VyLFxuXHRcdFx0b3B0aW9ucyxcblx0XHRcdGFkYXB0ZXIsXG5cdFx0XHRkZXBlbmRlbmNpZXM6IG5ldyBNYXAoKSxcblx0XHRcdGRlcGVuZGVudHM6IG5ldyBNYXAoKSxcblx0XHRcdHJlcXVlc3RzOiBuZXcgTWFwKCksXG5cdFx0XHRyZXNvbHZlclBhdGhzOiBuZXcgU2V0KCksXG5cdFx0XHRhc3luYzoge1xuXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZVxuXHRcdFx0fSxcblx0XHRcdHVuaW9uOiB7XG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0ZGlydHk6IHtcblx0XHRcdFx0dmFsdWU6IGZhbHNlLFxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZVxuXHRcdFx0fSxcblx0XHRcdGVycm9yOiB7XG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0Z2V0QmFiZWxyYzoge1xuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZVxuXHRcdFx0fSxcblx0XHRcdGdldFNvdXJjZUNoZWNrc3VtOiB7XG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0Z2V0T3B0aW9uc0NoZWNrc3VtOiB7XG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0aHlkcmF0ZToge1xuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZVxuXHRcdFx0fSxcblx0XHRcdGluZGV4OiB7XG5cdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0bG9hZGVkOiB7XG5cdFx0XHRcdHZhbHVlOiBmYWxzZSxcblx0XHRcdFx0d3JpdGFibGU6IHRydWVcblx0XHRcdH0sXG5cdFx0XHRtdXRhdGlvbnM6IHtcblx0XHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0XHRkZWZpbmU6IHt9LFxuXHRcdFx0XHRcdHByb3ZpZGU6IHt9XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0b3V0cHV0OiB7XG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0ZmFpbGVkOiB7XG5cdFx0XHRcdGdldDogKCkgPT4gcmVzb3VyY2VGYWN0b3J5LmZhaWxlZCxcblx0XHRcdFx0c2V0OiB2YWx1ZSA9PiB7XG5cdFx0XHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG5cdFx0XHRcdFx0cmVzb3VyY2VGYWN0b3J5LmZhaWxlZCA9IHZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0c291cmNlOiB7XG5cdFx0XHRcdGdldDogKCkgPT4gc291cmNlLFxuXHRcdFx0XHRzZXQ6IHZhbHVlID0+IHtcblx0XHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0c291cmNlID0gdmFsdWU7XG5cdFx0XHRcdFx0XHR0aGlzLnNpemUgPSBCdWZmZXIuYnl0ZUxlbmd0aCh2YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0aXNOb3JtYWw6ICgpID0+IHJlc291cmNlRmFjdG9yeS5pc05vcm1hbCh0aGlzKSxcblx0XHRcdGlzRXh0ZXJuYWw6ICgpID0+IHJlc291cmNlRmFjdG9yeS5pc0V4dGVybmFsKHRoaXMpLFxuXHRcdFx0aXNOdWxsOiAoKSA9PiByZXNvdXJjZUZhY3RvcnkuaXNOdWxsKHRoaXMpLFxuXHRcdFx0aXNJbnN0YWxsZWRQYWNrYWdlOiAoKSA9PiBjb250ZXh0RmFjdG9yeS5pc0luc3RhbGxlZFBhY2thZ2UodGhpcy5zbHVnKVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCBwaWNrKGN0eCwgWydlcnJvcicsICdtb2R1bGVJZCcsICdvcmlnaW4nLCAncGFja2FnZUlkJywgJ3BpZCcsICdzbHVnJ10pKTtcblx0fVxuXG5cdHNpemUgPSAtMTtcblxuXHRzb3VyY2VDaGVja3N1bSA9IG51bGw7XG5cblx0b3B0aW9uc0NoZWNrc3VtID0gbnVsbDtcblxuXHRnZXRPcHRpb25zQ2hlY2tzdW0gPSBvbmNlKCgpID0+IHtcblx0XHRjb25zdCB7IGRlZmluZSwgcHJvdmlkZSB9ID0gdGhpcy5tdXRhdGlvbnM7XG5cdFx0Y29uc3Qgc3VtbWFibGVPcHRpb25zID0ge1xuXHRcdFx0Li4ub21pdCh0aGlzLm9wdGlvbnMsIFsnd2F0Y2gnXSksXG5cdFx0XHRkZWZpbmU6IG1hcE9iamVjdChkZWZpbmUsIChfLCBrZXkpID0+IHRoaXMub3B0aW9ucy5kZWZpbmVba2V5XSksXG5cdFx0XHRwcm92aWRlOiBtYXBPYmplY3QocHJvdmlkZSwgKF8sIGtleSkgPT4gdGhpcy5vcHRpb25zLnByb3ZpZGVba2V5XSlcblx0XHR9O1xuXHRcdHJldHVybiBoYXNoKHN1bW1hYmxlT3B0aW9ucywgeyBhbGdvcml0aG06ICdtZDUnIH0pO1xuXHR9KTtcblxuXHRnZXRTb3VyY2VDaGVja3N1bSA9IG9uY2UoYXN5bmMgKCkgPT4ge1xuXHRcdGNvbnN0IHN0YXRzID0gYXdhaXQgc3RhdEFzeW5jKHRoaXMub3JpZ2luKTtcblx0XHRjb25zdCBwaWNrZWRTdGF0cyA9IHBpY2soc3RhdHMsIFsnY3RpbWUnLCAnbXRpbWUnLCAnaW5vJywgJ3NpemUnXSk7XG5cdFx0cmV0dXJuIGhhc2gocGlja2VkU3RhdHMsIHsgYWxnb3JpdGhtOiAnbWQ1JyB9KTtcblx0fSk7XG5cblx0Z2V0QmFiZWxyYyA9IG9uY2UoKCkgPT4ge1xuXHRcdGxldCBiYWJlbHJjID0gZ2V0KHRoaXMsIFsnb3B0aW9ucycsICdiYWJlbCcsICdiYWJlbHJjJ10pO1xuXHRcdGlmIChiYWJlbHJjICE9PSBmYWxzZSAmJiAhdGhpcy5pc0luc3RhbGxlZFBhY2thZ2UoKSkge1xuXHRcdFx0YmFiZWxyYyA9IHRoaXMuY29udGV4dEZhY3Rvcnkuc2FmZVJlc29sdmUoJy5iYWJlbHJjJywgdGhpcy5nZXRPcmlnaW5EaXIoKSk7XG5cdFx0fVxuXHRcdHJldHVybiBiYWJlbHJjIHx8IHVuZGVmaW5lZDtcblx0fSk7XG5cblx0Z2V0QmFiZWxPcHRpb25zID0gKCgpID0+IHtcblx0XHRsZXQgY2FsbGVkO1xuXHRcdHJldHVybiBkZWZpbmVQcm9wZXJ0aWVzKFxuXHRcdFx0KCkgPT4ge1xuXHRcdFx0XHQvLyBNYWtlIHN1cmUgYmFiZWwgb3B0aW9ucyBhcmUgb25seSBhcHBsaWVkIG9uY2Vcblx0XHRcdFx0Y29uc3Qgb3B0aW9ucyA9IGNhbGxlZFxuXHRcdFx0XHRcdD8ge31cblx0XHRcdFx0XHQ6IHtcblx0XHRcdFx0XHRcdFx0ZXh0ZW5kczogdGhpcy5nZXRCYWJlbHJjKCksXG5cdFx0XHRcdFx0XHRcdC4uLnRoaXMub3B0aW9ucy5iYWJlbFxuXHRcdFx0XHRcdCAgfTtcblx0XHRcdFx0Y2FsbGVkID0gdHJ1ZTtcblx0XHRcdFx0cmV0dXJuIG9wdGlvbnM7XG5cdFx0XHR9LFxuXHRcdFx0e1xuXHRcdFx0XHRjbGVhcjogKCkgPT4ge1xuXHRcdFx0XHRcdGNhbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KTtcblx0fSkoKTtcblxuXHRoeWRyYXRlID0gb25jZSgoeyByZXNvbHZlclBhdGhzLCAuLi5vdGhlciB9KSA9PiB7XG5cdFx0Y29uc3Qgc291cmNlID0gQXJyYXkuaXNBcnJheShvdGhlci5zb3VyY2UpID8gQnVmZmVyLmZyb20ob3RoZXIuc291cmNlKSA6IG90aGVyLnNvdXJjZTtcblx0XHRjb25zdCBvdXRwdXQgPVxuXHRcdFx0KEFycmF5LmlzQXJyYXkob3RoZXIub3V0cHV0KSA/IEJ1ZmZlci5mcm9tKG90aGVyLm91dHB1dCkgOiBvdGhlci5vdXRwdXQpIHx8IHNvdXJjZTtcblx0XHRPYmplY3QuYXNzaWduKHRoaXMsIG9taXQob3RoZXIsIFsnb3V0cHV0JywgJ3NvdXJjZScsICdyZXF1ZXN0cyddKSwgeyBvdXRwdXQsIHNvdXJjZSB9KTtcblx0XHRyZXNvbHZlclBhdGhzLmZvckVhY2gocmVsID0+IHtcblx0XHRcdHRoaXMucmVzb2x2ZXJQYXRocy5hZGQoUGF0aC5qb2luKHRoaXMub3B0aW9ucy5yb290RGlyLCByZWwpKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gdGhpcztcblx0fSk7XG5cblx0aXNPcnBoYW5lZCgpIHtcblx0XHRyZXR1cm4gdGhpcy5kZXBlbmRlbnRzLnNpemUgPT09IDAgJiYgIXRoaXMuc2FtZUFzKHRoaXMucmVzb3VyY2VGYWN0b3J5KCkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgd2hldGhlciB0aGUgcmVzb3VyY2Ugd2FzIHJlcXVlc3RlZCBhc3luY2hyb25vdXNseS5cblx0ICogVHJ1ZSBpZiBBTEwgcmVxdWVzdHMgYXJlIGFzeW5jLCBmYWxzZSBvdGhlcndpc2UuXG5cdCAqIENhbiBvbmx5IGNoYW5nZSBmcm9tOlxuXHQgKlx0MS4gdW5kZWZpbmVkID0+IHRydWVcblx0ICpcdDIuIHVuZGVmaW5lZCA9PiBmYWxzZVxuXHQgKlx0My4gdHJ1ZSA9PiBmYWxzZVxuXHQgKi9cblx0c2V0QXN5bmModmFsdWUpIHtcblx0XHRpZiAodGhpcy5hc3luYyA9PT0gdW5kZWZpbmVkIHx8ICh0aGlzLmFzeW5jICYmICF2YWx1ZSkpIHtcblx0XHRcdHRoaXMuYXN5bmMgPSBCb29sZWFuKHZhbHVlKTtcblx0XHR9XG5cdH1cblxuXHRhZGRUb1VuaW9uKGlkLCBvcHRpb25zKSB7XG5cdFx0aWYgKGdldCh0aGlzLCBbJ3VuaW9uJywgJ2lkJ10pICE9PSBpZCkge1xuXHRcdFx0dGhpcy5yZW1vdmVGcm9tVW5pb24oKTtcblx0XHRcdHRoaXMudW5pb24gPSB0aGlzLnVuaW9uRmFjdG9yeShpZCwge1xuXHRcdFx0XHRvcHRpb25zOiB7XG5cdFx0XHRcdFx0Li4udGhpcy5vcHRpb25zLFxuXHRcdFx0XHRcdC4uLm9wdGlvbnNcblx0XHRcdFx0fSxcblx0XHRcdFx0d3JpdGVyOiB0aGlzLmFkYXB0ZXIud3JpdGVyXG5cdFx0XHR9KTtcblx0XHRcdHRoaXMudW5pb24uYWRkKHRoaXMpO1xuXHRcdH1cblx0fVxuXG5cdHJlbW92ZUZyb21VbmlvbigpIHtcblx0XHRpZiAodGhpcy51bmlvbikge1xuXHRcdFx0dGhpcy51bmlvbi5kZWxldGUodGhpcyk7XG5cdFx0XHR0aGlzLnVuaW9uID0gbnVsbDtcblx0XHR9XG5cdH1cblxuXHRtYXJrRGlydHkoaGlzdG9yeSA9IG5ldyBTZXQoW3RoaXMucGlkXSkpIHtcblx0XHR0aGlzLmRpcnR5ID0gdHJ1ZTtcblx0XHR0aGlzLmxvYWRlZCA9IGZhbHNlO1xuXHRcdHRoaXMuc291cmNlQ2hlY2tzdW0gPSBudWxsO1xuXHRcdHRoaXMuZ2V0U291cmNlQ2hlY2tzdW0uY2xlYXIoKTtcblx0XHR0aGlzLmdldEJhYmVsT3B0aW9ucy5jbGVhcigpO1xuXG5cdFx0dGhpcy5kZXBlbmRlbnRzLmZvckVhY2gocmVzb3VyY2UgPT4ge1xuXHRcdFx0aWYgKCFoaXN0b3J5LmhhcyhyZXNvdXJjZS5waWQpKSB7XG5cdFx0XHRcdGhpc3RvcnkuYWRkKHJlc291cmNlLnBpZCk7XG5cdFx0XHRcdHJlc291cmNlLm1hcmtEaXJ0eShoaXN0b3J5KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMuZGVwZW5kZW5jaWVzLmZvckVhY2gocmVzb3VyY2UgPT4ge1xuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG5cdFx0XHRyZXNvdXJjZS5pbmRleCA9IHVuZGVmaW5lZDtcblx0XHR9KTtcblxuXHRcdHRoaXMuY29udGV4dEZhY3RvcnkudW5jYWNoZSh7IG9yaWdpbjogdGhpcy5vcmlnaW4gfSk7XG5cblx0XHRpZiAodGhpcy51bmlvbikge1xuXHRcdFx0dGhpcy51bmlvbi5yZXNldCh0aGlzKTtcblx0XHR9XG5cdH1cblxuXHRnZXRSZXNvbHZlclBhdGhzKCkge1xuXHRcdHJldHVybiBbdGhpcy5nZXRPcmlnaW5EaXIoKSwgLi4udGhpcy5yZXNvbHZlclBhdGhzXTtcblx0fVxuXG5cdGdldE1ldGEoKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdC4uLnBpY2sodGhpcywgWydpbmRleCcsICdtb2R1bGVJZCcsICdwaWQnXSksXG5cdFx0XHRvdXRwdXRTbHVnOiB0aGlzLmdldE91dHB1dFNsdWcoKSxcblx0XHRcdHR5cGU6IHRoaXMuYWRhcHRlci5vdXRwdXRUeXBlXG5cdFx0fTtcblx0fVxuXG5cdGdldE9yaWdpbkRpcigpIHtcblx0XHRyZXR1cm4gUGF0aC5kaXJuYW1lKHRoaXMub3JpZ2luKTtcblx0fVxuXG5cdGdldEFzc2V0SWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMudW5pb24gPyB0aGlzLnVuaW9uLmdldEFzc2V0SWQodGhpcykgOiB0aGlzLmdldE91dHB1dFNsdWcoKTtcblx0fVxuXG5cdGdldE91dHB1dFNsdWcoKSB7XG5cdFx0Y29uc3QgeyBhZGFwdGVyLCBzbHVnIH0gPSB0aGlzO1xuXHRcdGNvbnN0IHsgZXh0ZW5zaW9uIH0gPSBhZGFwdGVyLndyaXRlcjtcblx0XHRjb25zdCBleHQgPSBQYXRoLmV4dG5hbWUoc2x1Zyk7XG5cdFx0cmV0dXJuIGV4dCAmJiBleHRlbnNpb24gJiYgIXNsdWcuZW5kc1dpdGgoZXh0ZW5zaW9uKSA/IGAke3NsdWd9JHtleHRlbnNpb259YCA6IHNsdWc7XG5cdH1cblxuXHRnZXRPdXRwdXRQYXRoKCkge1xuXHRcdHJldHVybiBzbHVnVG9BYnNvbHV0ZVBhdGgodGhpcy5vcHRpb25zLm91dHB1dERpciwgdGhpcy5nZXRPdXRwdXRTbHVnKCkpO1xuXHR9XG5cblx0Z2V0T3V0cHV0RGlyKCkge1xuXHRcdHJldHVybiBQYXRoLmRpcm5hbWUodGhpcy5nZXRPdXRwdXRQYXRoKCkpO1xuXHR9XG5cblx0aXNQcmlzdGluZU9wdGlvbnMoKSB7XG5cdFx0cmV0dXJuIHRoaXMub3B0aW9uc0NoZWNrc3VtID09PSB0aGlzLmdldE9wdGlvbnNDaGVja3N1bSgpO1xuXHR9XG5cblx0YXN5bmMgaXNQcmlzdGluZVNvdXJjZSgpIHtcblx0XHRyZXR1cm4gdGhpcy5zb3VyY2VDaGVja3N1bSA9PT0gKGF3YWl0IHRoaXMuZ2V0U291cmNlQ2hlY2tzdW0oKSk7XG5cdH1cblxuXHRpc1ByaXN0aW5lU2VsZigpIHtcblx0XHRyZXR1cm4gIXRoaXMuZGlydHkgJiYgdGhpcy5pc1ByaXN0aW5lT3B0aW9ucygpICYmIHRoaXMuaXNQcmlzdGluZVNvdXJjZSgpO1xuXHR9XG5cblx0YXN5bmMgaXNQcmlzdGluZSgpIHtcblx0XHRsZXQgcmVzdWx0O1xuXHRcdGZvciAoY29uc3QgcmVzb3VyY2Ugb2YgW3RoaXMsIC4uLnRoaXMuZ2V0RGVlcERlcGVuZGVuY3lTZXQodW5kZWZpbmVkLCB0cnVlKV0pIHtcblx0XHRcdC8vIEl0IHR1cm5zIG91dCB0aGlzIGlzIH4yeCBmYXN0ZXIgdGhhbiBQcm9taXNlLmFsbFxuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWF3YWl0LWluLWxvb3Bcblx0XHRcdHJlc3VsdCA9IGF3YWl0IHJlc291cmNlLmlzUHJpc3RpbmVTZWxmKCk7XG5cdFx0XHRpZiAoIXJlc3VsdCkge1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGFzeW5jIHJlYWQoKSB7XG5cdFx0aWYgKCEoYXdhaXQgdGhpcy5pc1ByaXN0aW5lU291cmNlKCkpKSB7XG5cdFx0XHR0aGlzLnNvdXJjZSA9IGF3YWl0IHRoaXMuYWRhcHRlci5yZWFkZXIuYXBwbHkodGhpcyk7XG5cdFx0fVxuXHRcdHRoaXMuc291cmNlQ2hlY2tzdW0gPSBhd2FpdCB0aGlzLmdldFNvdXJjZUNoZWNrc3VtKCk7XG5cdH1cblxuXHR3cml0ZSgpIHtcblx0XHRyZXR1cm4gdGhpcy51bmlvbi53cml0ZSgpO1xuXHR9XG5cblx0YXN5bmMgcnVuVmlzaXRvcihuYW1lLCBmbiA9IG5vb3ApIHtcblx0XHRpZiAoIXRoaXMuZmFpbGVkKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRhd2FpdCB0aGlzLmFkYXB0ZXIucnVuVmlzaXRvcih0aGlzLCBbbmFtZSwgJ3ByZSddKTtcblx0XHRcdFx0YXdhaXQgZm4oKTtcblx0XHRcdFx0YXdhaXQgdGhpcy5hZGFwdGVyLnJ1blZpc2l0b3IodGhpcywgW25hbWUsICdwb3N0J10pO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdHRoaXMuZmFpbGVkID0gdHJ1ZTtcblx0XHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoYFJlc291cmNlICcke3RoaXMubW9kdWxlSWR9JyBmYWlsZWQgb24gdmlzaXRvciAnJHtuYW1lfSdgKTtcblx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGFzeW5jIHRyYXZlcnNlKGludGVyY2VwdG9yLCBoaXN0b3J5ID0gbmV3IFNldChbdGhpcy5waWRdKSkge1xuXHRcdGNvbnN0IHJlcXVlc3RQcm9jZXNzb3JzID0gW107XG5cdFx0bGV0IHNob3VsZFdyaXRlO1xuXG5cdFx0aWYgKCF0aGlzLnVuaW9uKSB7XG5cdFx0XHR0aGlzLmFkZFRvVW5pb24odGhpcy5zbHVnKTtcblx0XHR9XG5cblx0XHRpZiAoYXdhaXQgdGhpcy5pc1ByaXN0aW5lKCkpIHtcblx0XHRcdHRoaXMubG9nZ2VyLmRlYnVnKGBMb2FkZWQgJyR7dGhpcy5tb2R1bGVJZH0nIGZyb20gY2FjaGVgKTtcblx0XHRcdHRoaXMuZGVwZW5kZW5jaWVzLmZvckVhY2gocmVzb3VyY2UgPT4ge1xuXHRcdFx0XHRpZiAoIWhpc3RvcnkuaGFzKHJlc291cmNlLnBpZCkpIHtcblx0XHRcdFx0XHRoaXN0b3J5LmFkZChyZXNvdXJjZS5waWQpO1xuXHRcdFx0XHRcdHJlcXVlc3RQcm9jZXNzb3JzLnB1c2goKCkgPT4gcmVzb3VyY2UudHJhdmVyc2UoaW50ZXJjZXB0b3IsIGhpc3RvcnkpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uZC1hc3NpZ25cblx0XHR9IGVsc2UgaWYgKChzaG91bGRXcml0ZSA9IGF3YWl0IGludGVyY2VwdG9yKHRoaXMpKSkge1xuXHRcdFx0Y29uc3QgeyBhZGFwdGVyIH0gPSB0aGlzO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKGBUcmF2ZXJzZSAnJHt0aGlzLm1vZHVsZUlkfSdgKTtcblx0XHRcdHRoaXMub3B0aW9uc0NoZWNrc3VtID0gdGhpcy5nZXRPcHRpb25zQ2hlY2tzdW0oKTtcblxuXHRcdFx0YWRhcHRlci5wYXJzZXIuaW5pdCh0aGlzLnNsdWcsIHRoaXMub3JpZ2luLCBVcmwucmVzb2x2ZShgJHt0aGlzLm9wdGlvbnMuc2VydmVyLnVyaX0vYCwgJ18vJykpO1xuXG5cdFx0XHRhd2FpdCB0aGlzLnJ1blZpc2l0b3IoJ1JlYWQnLCAoKSA9PiB0aGlzLnJlYWQoKSk7XG5cblx0XHRcdHRoaXMub3V0cHV0ID0gdGhpcy5zb3VyY2U7XG5cblx0XHRcdGF3YWl0IHRoaXMucnVuVmlzaXRvcignUGFyc2UnLCAoKSA9PiB7XG5cdFx0XHRcdGFkYXB0ZXIucGFyc2VyLmxvYWQodGhpcy5vdXRwdXQpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGF3YWl0IHRoaXMucnVuVmlzaXRvcignUmVxdWVzdHMnLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IHJlbW92ZWREZXBlbmRlbmNpZXMgPSBuZXcgTWFwKFsuLi50aGlzLmRlcGVuZGVuY2llc10pO1xuXHRcdFx0XHR0aGlzLmRlcGVuZGVuY2llcy5jbGVhcigpO1xuXHRcdFx0XHR0aGlzLnJlcXVlc3RzLmNsZWFyKCk7XG5cdFx0XHRcdGFkYXB0ZXIucGFyc2VyLmdldFJlcXVlc3RzKCk7XG5cdFx0XHRcdGFkYXB0ZXIucGFyc2VyLnJlcXVlc3RzLmZvckVhY2gocmVxdWVzdE9iamVjdCA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgcmVzb3VyY2UgPSB0aGlzLnJlc291cmNlRmFjdG9yeShyZXF1ZXN0T2JqZWN0LCB0aGlzKTtcblx0XHRcdFx0XHR0aGlzLmFkZERlcGVuZGVuY3kocmVxdWVzdE9iamVjdCwgcmVzb3VyY2UpO1xuXHRcdFx0XHRcdGlmICghaGlzdG9yeS5oYXMocmVzb3VyY2UucGlkKSkge1xuXHRcdFx0XHRcdFx0aGlzdG9yeS5hZGQocmVzb3VyY2UucGlkKTtcblx0XHRcdFx0XHRcdHJlcXVlc3RQcm9jZXNzb3JzLnB1c2goKCkgPT4gcmVzb3VyY2UudHJhdmVyc2UoaW50ZXJjZXB0b3IsIGhpc3RvcnkpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmVtb3ZlZERlcGVuZGVuY2llcy5kZWxldGUocmVzb3VyY2UucGlkKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdC8vIENsZWFuIHVwIHJlbW92ZWQgcmVzb3VyY2UgZGVwZW5kZW50c1xuXHRcdFx0XHRyZW1vdmVkRGVwZW5kZW5jaWVzLmZvckVhY2gocmVzb3VyY2UgPT4ge1xuXHRcdFx0XHRcdHRoaXMucmVtb3ZlRGVwZW5kZW5jeShyZXNvdXJjZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdGF3YWl0IHRoaXMucnVuVmlzaXRvcignR2VuZXJhdGUnLCAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuZ2VuZXJhdGUoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm91dHB1dCA9IGFkYXB0ZXIucGFyc2VyLm91dHB1dDtcblx0XHR9XG5cblx0XHRpZiAocmVxdWVzdFByb2Nlc3NvcnMubGVuZ3RoKSB7XG5cdFx0XHRhd2FpdCBQcm9taXNlLmFsbChyZXF1ZXN0UHJvY2Vzc29ycy5tYXAoZm4gPT4gZm4oKSkpO1xuXHRcdH1cblxuXHRcdHRoaXMubG9hZGVkID0gdHJ1ZTtcblx0XHR0aGlzLmRpcnR5ID0gZmFsc2U7XG5cblx0XHRpZiAoc2hvdWxkV3JpdGUpIHtcblx0XHRcdGF3YWl0IHRoaXMucnVuVmlzaXRvcignV3JpdGUnLCAoKSA9PiB0aGlzLndyaXRlKCkpO1xuXHRcdH1cblx0fVxuXG5cdGFwcGx5TXV0YXRpb25zKCkge1xuXHRcdC8vIFJlc2V0IG11dGF0aW9ucyBvYmplY3RzXG5cdFx0dGhpcy5tdXRhdGlvbnMuZGVmaW5lID0ge307XG5cdFx0dGhpcy5tdXRhdGlvbnMucHJvdmlkZSA9IHt9O1xuXG5cdFx0T2JqZWN0LmVudHJpZXModGhpcy5vcHRpb25zLmRlZmluZSkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG5cdFx0XHR0aGlzLmRlZmluZShrZXksIHZhbHVlKTtcblx0XHR9KTtcblxuXHRcdE9iamVjdC5lbnRyaWVzKHRoaXMub3B0aW9ucy5wcm92aWRlKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcblx0XHRcdHRoaXMucHJvdmlkZShrZXksIHZhbHVlKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuZ2V0T3B0aW9uc0NoZWNrc3VtLmNsZWFyKCk7XG5cdFx0dGhpcy5vcHRpb25zQ2hlY2tzdW0gPSB0aGlzLmdldE9wdGlvbnNDaGVja3N1bSgpO1xuXHR9XG5cblx0ZGVmaW5lKGtleSwgdmFsdWUpIHtcblx0XHRjb25zdCBxdWVyeSA9IGBcblx0XHRcdC8vIFByb2dyYW0gWyhcblx0XHRcdFx0Ly8gJHt0aGlzLmFkYXB0ZXIucGFyc2VyLmJ1aWxkUXVlcnkoa2V5KX1cblx0XHRcdCkgJiYgISgoXG5cdFx0XHRcdC8vIEFzc2lnbm1lbnRFeHByZXNzaW9uIFtcblx0XHRcdFx0XHQvOmxlZnQgJHt0aGlzLmFkYXB0ZXIucGFyc2VyLmJ1aWxkUXVlcnkoa2V5KX1cblx0XHRcdFx0XVxuXHRcdFx0KSB8fCAoXG5cdFx0XHRcdC8vIEltcG9ydERlY2xhcmF0aW9uIC8vICR7dGhpcy5hZGFwdGVyLnBhcnNlci5idWlsZFF1ZXJ5KGtleSl9XG5cdFx0XHQpIHx8ICR7XG5cdFx0XHRcdC8vIEZJWE1FOiB3aHkgZG9lc24ndCB0aGlzIHdvcmsgd2l0aG91dCAnLi4uIHx8IGZhbHNlJz9cblx0XHRcdFx0ZmFsc2Vcblx0XHRcdH0pXVxuXHRcdGA7XG5cdFx0aWYgKHRoaXMuYWRhcHRlci5wYXJzZXIuaGFzTm9kZShxdWVyeSkpIHtcblx0XHRcdHRoaXMubXV0YXRpb25zLmRlZmluZVtrZXldID0gdmFsdWU7XG5cdFx0fVxuXHR9XG5cblx0cHJvdmlkZShrZXksIHZhbHVlKSB7XG5cdFx0Y29uc3QgeyBhZGFwdGVyLCBtdXRhdGlvbnMgfSA9IHRoaXM7XG5cdFx0Ly8gTWFrZSBzdXJlIHRoZSBwcm92aWRlIGtleSBpcyByZWZlcmVuY2VkIGJ1dCBub3QgZGVjbGFyZWQgb3IgYXNzaWduZWRcblx0XHRjb25zdCBxdWVyeSA9IGBcblx0XHRcdC8vIFByb2dyYW0gWyhcblx0XHRcdFx0Ly8gJHthZGFwdGVyLnBhcnNlci5idWlsZFF1ZXJ5KGtleSl9XG5cdFx0XHQpICYmICEoKFxuXHRcdFx0XHQvLyBWYXJpYWJsZURlY2xhcmF0b3IgW1xuXHRcdFx0XHRcdC86aWQgJHthZGFwdGVyLnBhcnNlci5idWlsZFF1ZXJ5KGtleSl9XG5cdFx0XHRcdF1cblx0XHRcdCkgfHwgKFxuXHRcdFx0XHQvLyBGdW5jdGlvbkRlY2xhcmF0aW9uIFtcblx0XHRcdFx0XHQvOmlkICR7YWRhcHRlci5wYXJzZXIuYnVpbGRRdWVyeShrZXkpfVxuXHRcdFx0XHRdXG5cdFx0XHQpIHx8IChcblx0XHRcdFx0Ly8gQXNzaWdubWVudEV4cHJlc3Npb24gW1xuXHRcdFx0XHRcdC86bGVmdCAke2FkYXB0ZXIucGFyc2VyLmJ1aWxkUXVlcnkoa2V5KX1cblx0XHRcdFx0XVxuXHRcdFx0KSB8fCAoXG5cdFx0XHRcdC8vIEltcG9ydERlY2xhcmF0aW9uIC8vICR7YWRhcHRlci5wYXJzZXIuYnVpbGRRdWVyeShrZXkpfVxuXHRcdFx0KSldXG5cdFx0YDtcblx0XHRpZiAoYWRhcHRlci5wYXJzZXIuaGFzTm9kZShxdWVyeSkpIHtcblx0XHRcdGNvbnN0IGFzdCA9IGFkYXB0ZXIucGFyc2VyLnBhcnNlKFN0cmluZyh2YWx1ZSksIHtcblx0XHRcdFx0YWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlOiB0cnVlLFxuXHRcdFx0XHRhbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbjogdHJ1ZSxcblx0XHRcdFx0YWxsb3dTdXBlck91dHNpZGVNZXRob2Q6IHRydWVcblx0XHRcdH0pO1xuXHRcdFx0Y29uc3QgW2ltcG9ydERlY2xhcmF0aW9uXSA9IGFkYXB0ZXIucGFyc2VyLnJ1blF1ZXJ5KCcvLyBJbXBvcnREZWNsYXJhdGlvbicsIGFzdCk7XG5cdFx0XHRpZiAoaW1wb3J0RGVjbGFyYXRpb24gJiYgIXRoaXMuc2FtZUFzKGltcG9ydERlY2xhcmF0aW9uLnNvdXJjZS52YWx1ZSkpIHtcblx0XHRcdFx0bXV0YXRpb25zLnByb3ZpZGVba2V5XSA9IGRlZmluZVByb3BlcnRpZXMoaW1wb3J0RGVjbGFyYXRpb24sIHtcblx0XHRcdFx0XHR0b0pTT046ICgpID0+IHZhbHVlXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bXV0YXRpb25zLnByb3ZpZGVba2V5XSA9IFN0cmluZyh2YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0dHJhbnNmb3JtKG9wdGlvbnMpIHtcblx0XHRyZXR1cm4gdGhpcy5hZGFwdGVyLnBhcnNlci50cmFuc2Zvcm0odGhpcywgb3B0aW9ucyk7XG5cdH1cblxuXHRnZW5lcmF0ZShvcHRpb25zKSB7XG5cdFx0cmV0dXJuIHRoaXMuYWRhcHRlci5wYXJzZXIuZ2VuZXJhdGUodGhpcywgb3B0aW9ucyk7XG5cdH1cblxuXHRjb21wcmVzcyhvcHRpb25zKSB7XG5cdFx0cmV0dXJuIHRoaXMuYWRhcHRlci5wYXJzZXIuY29tcHJlc3ModGhpcywgb3B0aW9ucyk7XG5cdH1cblxuXHRhZGREZXBlbmRlbmN5KHJlcXVlc3RPYmplY3QsIHJlc291cmNlKSB7XG5cdFx0Y29uc3QgeyBkZXBlbmRlbmNpZXMsIHJlcXVlc3RzIH0gPSB0aGlzO1xuXHRcdGlmICghcmVxdWVzdHMuaGFzKHJlcXVlc3RPYmplY3Qua2V5KSkge1xuXHRcdFx0cmVxdWVzdHMuc2V0KHJlcXVlc3RPYmplY3Qua2V5LCB7IC4uLnJlcXVlc3RPYmplY3QsIHBpZDogcmVzb3VyY2UucGlkIH0pO1xuXHRcdH1cblx0XHRpZiAoIWRlcGVuZGVuY2llcy5oYXMocmVzb3VyY2UucGlkKSkge1xuXHRcdFx0ZGVwZW5kZW5jaWVzLnNldChyZXNvdXJjZS5waWQsIHJlc291cmNlKTtcblx0XHR9XG5cdFx0aWYgKCFyZXNvdXJjZS5kZXBlbmRlbnRzLmhhcyh0aGlzLnBpZCkpIHtcblx0XHRcdHJlc291cmNlLmRlcGVuZGVudHMuc2V0KHRoaXMucGlkLCB0aGlzKTtcblx0XHR9XG5cdH1cblxuXHRyZW1vdmVEZXBlbmRlbmN5KHJlc291cmNlKSB7XG5cdFx0cmVzb3VyY2UuZGVwZW5kZW50cy5kZWxldGUodGhpcy5waWQpO1xuXHRcdGlmIChyZXNvdXJjZS5pc09ycGhhbmVkKCkpIHtcblx0XHRcdGlmICh0aGlzLnVuaW9uKSB7XG5cdFx0XHRcdHRoaXMudW5pb24uZGVsZXRlKHJlc291cmNlKTtcblx0XHRcdH1cblx0XHRcdHJlc291cmNlLmRlcGVuZGVuY2llcy5mb3JFYWNoKGRlcGVuZGVuY3kgPT4ge1xuXHRcdFx0XHRyZXNvdXJjZS5yZW1vdmVEZXBlbmRlbmN5KGRlcGVuZGVuY3kpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0c2FtZUFzKHJlcXVlc3QpIHtcblx0XHRyZXR1cm4gQm9vbGVhbihyZXF1ZXN0ICYmIHRoaXMucmVzb3VyY2VGYWN0b3J5KHJlcXVlc3QsIHRoaXMpLnBpZCA9PT0gdGhpcy5waWQpO1xuXHR9XG5cblx0ZGVwZW5kZW5jeU9mKHJlcXVlc3QsIGhpc3RvcnkgPSBuZXcgU2V0KFt0aGlzLnBpZF0pKSB7XG5cdFx0Y29uc3QgcmVzb3VyY2UgPSB0aGlzLnJlc291cmNlRmFjdG9yeShyZXF1ZXN0LCB0aGlzKTtcblx0XHRsZXQgcmVzdWx0ID0gdGhpcy5kZXBlbmRlbnRzLmhhcyhyZXNvdXJjZS5waWQpO1xuXHRcdGlmICghcmVzdWx0KSB7XG5cdFx0XHRmb3IgKGNvbnN0IFssIGRlcGVuZGVudF0gb2YgdGhpcy5kZXBlbmRlbnRzKSB7XG5cdFx0XHRcdGlmICghaGlzdG9yeS5oYXMoZGVwZW5kZW50LnBpZCkpIHtcblx0XHRcdFx0XHRoaXN0b3J5LmFkZChkZXBlbmRlbnQucGlkKTtcblx0XHRcdFx0XHRyZXN1bHQgPSBkZXBlbmRlbnQuZGVwZW5kZW5jeU9mKHJlc291cmNlLCBoaXN0b3J5KTtcblx0XHRcdFx0XHRpZiAocmVzdWx0KSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGdldERlZXBEZXBlbmRlbmN5U2V0KGZpbHRlciwgZGFuZ2Vyb3VzLCBhY2MgPSBuZXcgU2V0KCkpIHtcblx0XHRpZiAoIWRhbmdlcm91cyAmJiAhdGhpcy5sb2FkZWQpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignQ2Fubm90IGd1YXJhbnRlZSBhIGZ1bGwgZGVwZW5kZW5jeSBzZXQgYmVmb3JlIHRoZSBlbnRpcmUgdHJlZSBpcyBsb2FkZWQnKTtcblx0XHR9XG5cdFx0Y29uc3QgY2hpbGREZXBlbmRlbmN5R2V0dGVycyA9IFtdO1xuXHRcdGZvciAoY29uc3QgWywgcmVxdWVzdF0gb2YgdGhpcy5yZXF1ZXN0cykge1xuXHRcdFx0Y29uc3QgcmVzb3VyY2UgPSB0aGlzLmRlcGVuZGVuY2llcy5nZXQocmVxdWVzdC5waWQpO1xuXHRcdFx0aWYgKCFmaWx0ZXIgfHwgZmlsdGVyKHJlc291cmNlLCByZXF1ZXN0KSkge1xuXHRcdFx0XHRpZiAoYWNjLmhhcyhyZXNvdXJjZSkpIHtcblx0XHRcdFx0XHRhY2MuZGVsZXRlKHJlc291cmNlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjaGlsZERlcGVuZGVuY3lHZXR0ZXJzLnB1c2goKCkgPT4gcmVzb3VyY2UuZ2V0RGVlcERlcGVuZGVuY3lTZXQoZmlsdGVyLCBkYW5nZXJvdXMsIGFjYykpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGFjYy5hZGQocmVzb3VyY2UpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRmb3IgKGNvbnN0IGZuIG9mIGNoaWxkRGVwZW5kZW5jeUdldHRlcnMpIHtcblx0XHRcdGZuKCk7XG5cdFx0fVxuXHRcdHJldHVybiBhY2M7XG5cdH1cblxuXHRnZXREZXBlbmRlbmNpZXNCeVJlcXVlc3QoZmlsdGVyID0gKCkgPT4gdHJ1ZSkge1xuXHRcdGNvbnN0IHJlc291cmNlcyA9IG5ldyBNYXAoKTtcblx0XHRmb3IgKGNvbnN0IFssIHJlcXVlc3RdIG9mIHRoaXMucmVxdWVzdHMpIHtcblx0XHRcdGNvbnN0IHJlc291cmNlID0gdGhpcy5kZXBlbmRlbmNpZXMuZ2V0KHJlcXVlc3QucGlkKTtcblx0XHRcdGlmIChmaWx0ZXIocmVzb3VyY2UpKSB7XG5cdFx0XHRcdHJlc291cmNlcy5zZXQocmVxdWVzdC52YWx1ZSwgcmVzb3VyY2UpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gcmVzb3VyY2VzO1xuXHR9XG5cblx0Z2V0UmVxdWVzdE1hcChmaWx0ZXIpIHtcblx0XHRjb25zdCByZXF1ZXN0TWFwID0gdGhpcy5nZXREZXBlbmRlbmNpZXNCeVJlcXVlc3QoZmlsdGVyKTtcblx0XHRmb3IgKGNvbnN0IFtrZXksIHJlc291cmNlXSBvZiByZXF1ZXN0TWFwKSB7XG5cdFx0XHRzd2l0Y2ggKHRydWUpIHtcblx0XHRcdFx0Y2FzZSByZXNvdXJjZS5pc0V4dGVybmFsKCk6XG5cdFx0XHRcdFx0cmVxdWVzdE1hcC5zZXQoa2V5LCByZXNvdXJjZS5tb2R1bGVJZCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgcmVzb3VyY2UuaXNOdWxsKCk6XG5cdFx0XHRcdFx0cmVxdWVzdE1hcC5zZXQoa2V5LCBudWxsKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRyZXF1ZXN0TWFwLnNldChrZXksIHJlc291cmNlLnBpZCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiByZXF1ZXN0TWFwO1xuXHR9XG5cblx0dG9KU09OKCkge1xuXHRcdGNvbnN0IHsgY29udGV4dEZhY3RvcnksIG11dGF0aW9ucywgcmVzb2x2ZXJQYXRocyB9ID0gdGhpcztcblx0XHRjb25zdCByZXF1ZXN0cyA9IFsuLi50aGlzLnJlcXVlc3RzLnZhbHVlcygpXS5tYXAocmVxID0+IG9taXQocmVxLCBbJ3BpZCddKSk7XG5cdFx0Y29uc3Qgc291cmNlID0gQnVmZmVyLmlzQnVmZmVyKHRoaXMuc291cmNlKSA/IEFycmF5LmZyb20odGhpcy5zb3VyY2UpIDogdGhpcy5zb3VyY2U7XG5cdFx0Y29uc3Qgb3V0cHV0ID1cblx0XHRcdCh0aGlzLm91dHB1dCAhPT0gdGhpcy5zb3VyY2UgJiZcblx0XHRcdFx0KEJ1ZmZlci5pc0J1ZmZlcih0aGlzLm91dHB1dCkgPyBBcnJheS5mcm9tKHRoaXMub3V0cHV0KSA6IHRoaXMub3V0cHV0KSkgfHxcblx0XHRcdHVuZGVmaW5lZDtcblx0XHRyZXR1cm4ge1xuXHRcdFx0Li4ucGlja0J5KHRoaXMsIGlzUHJpbWl0aXZlKSxcblx0XHRcdG9yaWdpbjogdW5kZWZpbmVkLFxuXHRcdFx0cmVzb2x2ZXJQYXRoczogWy4uLnJlc29sdmVyUGF0aHNdLm1hcChkaXIgPT4gY29udGV4dEZhY3RvcnkuZ2V0U2x1ZyhkaXIpKSxcblx0XHRcdG11dGF0aW9ucyxcblx0XHRcdHJlcXVlc3RzLFxuXHRcdFx0c291cmNlLFxuXHRcdFx0b3V0cHV0XG5cdFx0fTtcblx0fVxufVxuIl19
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var babylon = _interopRequireWildcard(require("@babel/parser"));

var babel = _interopRequireWildcard(require("@babel/core"));

var t = _interopRequireWildcard(require("@babel/types"));

var _generator = _interopRequireDefault(require("@babel/generator"));

var _template = _interopRequireDefault(require("@babel/template"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

const manifestTemplate = (0, _template.default)(`
	const IDENTITY = value => value;

	const PICK = (target, keys) =>
		keys.reduce((acc, key) => {
			acc[key] = target[key];
			return acc;
		}, {});

	module.exports = ({
		KEYS = ['assetId', 'moduleId', 'pid', 'type'],
		FILTER = DEFAULT_FILTER,
		ASSET_MAP = {}
	} = {}) => MANIFEST;
`);

var _default = manifest => {
  const _manifest$toJSON = manifest.toJSON(),
        {
    dependencies,
    meta
  } = _manifest$toJSON,
        other = _objectWithoutProperties(_manifest$toJSON, ["dependencies", "meta"]);

  const keysIdentifier = t.Identifier('keys');
  const pickIdentifier = t.Identifier('pick');
  const identityIdentifier = t.Identifier('identity');
  const filterIdentifier = t.Identifier('dependencyFilter');
  const assetMapIdentifier = t.Identifier('assetMap');

  function buildMetaObjectExpression(value) {
    const metaObjectExpression = babylon.parseExpression(JSON.stringify(value));
    const assetMetaExpression = t.MemberExpression(assetMapIdentifier, t.StringLiteral(value.outputSlug), true);
    metaObjectExpression.properties.push(t.ObjectProperty(t.StringLiteral('assetId'), t.ConditionalExpression(assetMetaExpression, t.BinaryExpression('+', t.StringLiteral('~/'), assetMetaExpression), t.StringLiteral(value.moduleId))));
    return metaObjectExpression;
  }

  function buildPickExpression(value) {
    return t.CallExpression(t.ConditionalExpression(keysIdentifier, pickIdentifier, identityIdentifier), [t.isIdentifier(value) ? value : buildMetaObjectExpression(value), keysIdentifier]);
  }

  function buildDependenciesCallExpression(filterNode) {
    return t.CallExpression(t.MemberExpression(t.ArrayExpression(dependencies.map(value => buildMetaObjectExpression(value))), t.Identifier('filter')), [filterNode]);
  }

  let ast = t.Program(manifestTemplate({
    PICK: pickIdentifier,
    IDENTITY: identityIdentifier,
    KEYS: keysIdentifier,
    FILTER: filterIdentifier,
    DEFAULT_FILTER: t.ArrowFunctionExpression([t.Identifier('meta')], t.BinaryExpression('===', t.Identifier('meta.type'), t.StringLiteral(meta.type))),
    MANIFEST: t.ObjectExpression([t.ObjectProperty(t.StringLiteral('meta'), buildPickExpression(meta)), ...Object.entries(other).map(([key, value]) => t.ObjectProperty(t.StringLiteral(key), babylon.parseExpression(JSON.stringify(value)))), t.ObjectProperty(t.StringLiteral('dependencies'), t.CallExpression(t.MemberExpression(buildDependenciesCallExpression(filterIdentifier), t.Identifier('map')), [t.ArrowFunctionExpression([t.Identifier('meta')], buildPickExpression(t.Identifier('meta')))]))]),
    ASSET_MAP: assetMapIdentifier
  }));
  ({
    ast
  } = babel.transformFromAst(ast, null, {
    ast: true,
    babelrc: false,
    presets: [['@babel/env', {
      targets: {
        node: 'current'
      }
    }]]
  }));
  return (0, _generator.default)(ast).code;
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zZXJ2ZXIvaW5zdGFsbGVyL2dlbmVyYXRvcnMvbWFuaWZlc3QuanMiXSwibmFtZXMiOlsibWFuaWZlc3RUZW1wbGF0ZSIsIm1hbmlmZXN0IiwidG9KU09OIiwiZGVwZW5kZW5jaWVzIiwibWV0YSIsIm90aGVyIiwia2V5c0lkZW50aWZpZXIiLCJ0IiwiSWRlbnRpZmllciIsInBpY2tJZGVudGlmaWVyIiwiaWRlbnRpdHlJZGVudGlmaWVyIiwiZmlsdGVySWRlbnRpZmllciIsImFzc2V0TWFwSWRlbnRpZmllciIsImJ1aWxkTWV0YU9iamVjdEV4cHJlc3Npb24iLCJ2YWx1ZSIsIm1ldGFPYmplY3RFeHByZXNzaW9uIiwiYmFieWxvbiIsInBhcnNlRXhwcmVzc2lvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJhc3NldE1ldGFFeHByZXNzaW9uIiwiTWVtYmVyRXhwcmVzc2lvbiIsIlN0cmluZ0xpdGVyYWwiLCJvdXRwdXRTbHVnIiwicHJvcGVydGllcyIsInB1c2giLCJPYmplY3RQcm9wZXJ0eSIsIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsIkJpbmFyeUV4cHJlc3Npb24iLCJtb2R1bGVJZCIsImJ1aWxkUGlja0V4cHJlc3Npb24iLCJDYWxsRXhwcmVzc2lvbiIsImlzSWRlbnRpZmllciIsImJ1aWxkRGVwZW5kZW5jaWVzQ2FsbEV4cHJlc3Npb24iLCJmaWx0ZXJOb2RlIiwiQXJyYXlFeHByZXNzaW9uIiwibWFwIiwiYXN0IiwiUHJvZ3JhbSIsIlBJQ0siLCJJREVOVElUWSIsIktFWVMiLCJGSUxURVIiLCJERUZBVUxUX0ZJTFRFUiIsIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiwidHlwZSIsIk1BTklGRVNUIiwiT2JqZWN0RXhwcmVzc2lvbiIsIk9iamVjdCIsImVudHJpZXMiLCJrZXkiLCJBU1NFVF9NQVAiLCJiYWJlbCIsInRyYW5zZm9ybUZyb21Bc3QiLCJiYWJlbHJjIiwicHJlc2V0cyIsInRhcmdldHMiLCJub2RlIiwiY29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUcsdUJBQVU7Ozs7Ozs7Ozs7Ozs7O0NBQVYsQ0FBekI7O2VBZ0JlQyxRQUFRLElBQUk7QUFDMUIsMkJBQXlDQSxRQUFRLENBQUNDLE1BQVQsRUFBekM7QUFBQSxRQUFNO0FBQUVDLElBQUFBLFlBQUY7QUFBZ0JDLElBQUFBO0FBQWhCLEdBQU47QUFBQSxRQUErQkMsS0FBL0I7O0FBQ0EsUUFBTUMsY0FBYyxHQUFHQyxDQUFDLENBQUNDLFVBQUYsQ0FBYSxNQUFiLENBQXZCO0FBQ0EsUUFBTUMsY0FBYyxHQUFHRixDQUFDLENBQUNDLFVBQUYsQ0FBYSxNQUFiLENBQXZCO0FBQ0EsUUFBTUUsa0JBQWtCLEdBQUdILENBQUMsQ0FBQ0MsVUFBRixDQUFhLFVBQWIsQ0FBM0I7QUFDQSxRQUFNRyxnQkFBZ0IsR0FBR0osQ0FBQyxDQUFDQyxVQUFGLENBQWEsa0JBQWIsQ0FBekI7QUFDQSxRQUFNSSxrQkFBa0IsR0FBR0wsQ0FBQyxDQUFDQyxVQUFGLENBQWEsVUFBYixDQUEzQjs7QUFFQSxXQUFTSyx5QkFBVCxDQUFtQ0MsS0FBbkMsRUFBMEM7QUFDekMsVUFBTUMsb0JBQW9CLEdBQUdDLE9BQU8sQ0FBQ0MsZUFBUixDQUF3QkMsSUFBSSxDQUFDQyxTQUFMLENBQWVMLEtBQWYsQ0FBeEIsQ0FBN0I7QUFDQSxVQUFNTSxtQkFBbUIsR0FBR2IsQ0FBQyxDQUFDYyxnQkFBRixDQUMzQlQsa0JBRDJCLEVBRTNCTCxDQUFDLENBQUNlLGFBQUYsQ0FBZ0JSLEtBQUssQ0FBQ1MsVUFBdEIsQ0FGMkIsRUFHM0IsSUFIMkIsQ0FBNUI7QUFLQVIsSUFBQUEsb0JBQW9CLENBQUNTLFVBQXJCLENBQWdDQyxJQUFoQyxDQUNDbEIsQ0FBQyxDQUFDbUIsY0FBRixDQUNDbkIsQ0FBQyxDQUFDZSxhQUFGLENBQWdCLFNBQWhCLENBREQsRUFFQ2YsQ0FBQyxDQUFDb0IscUJBQUYsQ0FDQ1AsbUJBREQsRUFFQ2IsQ0FBQyxDQUFDcUIsZ0JBQUYsQ0FBbUIsR0FBbkIsRUFBd0JyQixDQUFDLENBQUNlLGFBQUYsQ0FBZ0IsSUFBaEIsQ0FBeEIsRUFBK0NGLG1CQUEvQyxDQUZELEVBR0NiLENBQUMsQ0FBQ2UsYUFBRixDQUFnQlIsS0FBSyxDQUFDZSxRQUF0QixDQUhELENBRkQsQ0FERDtBQVVBLFdBQU9kLG9CQUFQO0FBQ0E7O0FBRUQsV0FBU2UsbUJBQVQsQ0FBNkJoQixLQUE3QixFQUFvQztBQUNuQyxXQUFPUCxDQUFDLENBQUN3QixjQUFGLENBQ054QixDQUFDLENBQUNvQixxQkFBRixDQUF3QnJCLGNBQXhCLEVBQXdDRyxjQUF4QyxFQUF3REMsa0JBQXhELENBRE0sRUFFTixDQUFDSCxDQUFDLENBQUN5QixZQUFGLENBQWVsQixLQUFmLElBQXdCQSxLQUF4QixHQUFnQ0QseUJBQXlCLENBQUNDLEtBQUQsQ0FBMUQsRUFBbUVSLGNBQW5FLENBRk0sQ0FBUDtBQUlBOztBQUVELFdBQVMyQiwrQkFBVCxDQUF5Q0MsVUFBekMsRUFBcUQ7QUFDcEQsV0FBTzNCLENBQUMsQ0FBQ3dCLGNBQUYsQ0FDTnhCLENBQUMsQ0FBQ2MsZ0JBQUYsQ0FDQ2QsQ0FBQyxDQUFDNEIsZUFBRixDQUFrQmhDLFlBQVksQ0FBQ2lDLEdBQWIsQ0FBaUJ0QixLQUFLLElBQUlELHlCQUF5QixDQUFDQyxLQUFELENBQW5ELENBQWxCLENBREQsRUFFQ1AsQ0FBQyxDQUFDQyxVQUFGLENBQWEsUUFBYixDQUZELENBRE0sRUFLTixDQUFDMEIsVUFBRCxDQUxNLENBQVA7QUFPQTs7QUFFRCxNQUFJRyxHQUFHLEdBQUc5QixDQUFDLENBQUMrQixPQUFGLENBQ1R0QyxnQkFBZ0IsQ0FBQztBQUNoQnVDLElBQUFBLElBQUksRUFBRTlCLGNBRFU7QUFFaEIrQixJQUFBQSxRQUFRLEVBQUU5QixrQkFGTTtBQUdoQitCLElBQUFBLElBQUksRUFBRW5DLGNBSFU7QUFJaEJvQyxJQUFBQSxNQUFNLEVBQUUvQixnQkFKUTtBQUtoQmdDLElBQUFBLGNBQWMsRUFBRXBDLENBQUMsQ0FBQ3FDLHVCQUFGLENBQ2YsQ0FBQ3JDLENBQUMsQ0FBQ0MsVUFBRixDQUFhLE1BQWIsQ0FBRCxDQURlLEVBRWZELENBQUMsQ0FBQ3FCLGdCQUFGLENBQW1CLEtBQW5CLEVBQTBCckIsQ0FBQyxDQUFDQyxVQUFGLENBQWEsV0FBYixDQUExQixFQUFxREQsQ0FBQyxDQUFDZSxhQUFGLENBQWdCbEIsSUFBSSxDQUFDeUMsSUFBckIsQ0FBckQsQ0FGZSxDQUxBO0FBU2hCQyxJQUFBQSxRQUFRLEVBQUV2QyxDQUFDLENBQUN3QyxnQkFBRixDQUFtQixDQUM1QnhDLENBQUMsQ0FBQ21CLGNBQUYsQ0FBaUJuQixDQUFDLENBQUNlLGFBQUYsQ0FBZ0IsTUFBaEIsQ0FBakIsRUFBMENRLG1CQUFtQixDQUFDMUIsSUFBRCxDQUE3RCxDQUQ0QixFQUU1QixHQUFHNEMsTUFBTSxDQUFDQyxPQUFQLENBQWU1QyxLQUFmLEVBQXNCK0IsR0FBdEIsQ0FBMEIsQ0FBQyxDQUFDYyxHQUFELEVBQU1wQyxLQUFOLENBQUQsS0FDNUJQLENBQUMsQ0FBQ21CLGNBQUYsQ0FBaUJuQixDQUFDLENBQUNlLGFBQUYsQ0FBZ0I0QixHQUFoQixDQUFqQixFQUF1Q2xDLE9BQU8sQ0FBQ0MsZUFBUixDQUF3QkMsSUFBSSxDQUFDQyxTQUFMLENBQWVMLEtBQWYsQ0FBeEIsQ0FBdkMsQ0FERSxDQUZ5QixFQUs1QlAsQ0FBQyxDQUFDbUIsY0FBRixDQUNDbkIsQ0FBQyxDQUFDZSxhQUFGLENBQWdCLGNBQWhCLENBREQsRUFFQ2YsQ0FBQyxDQUFDd0IsY0FBRixDQUNDeEIsQ0FBQyxDQUFDYyxnQkFBRixDQUNDWSwrQkFBK0IsQ0FBQ3RCLGdCQUFELENBRGhDLEVBRUNKLENBQUMsQ0FBQ0MsVUFBRixDQUFhLEtBQWIsQ0FGRCxDQURELEVBS0MsQ0FDQ0QsQ0FBQyxDQUFDcUMsdUJBQUYsQ0FDQyxDQUFDckMsQ0FBQyxDQUFDQyxVQUFGLENBQWEsTUFBYixDQUFELENBREQsRUFFQ3NCLG1CQUFtQixDQUFDdkIsQ0FBQyxDQUFDQyxVQUFGLENBQWEsTUFBYixDQUFELENBRnBCLENBREQsQ0FMRCxDQUZELENBTDRCLENBQW5CLENBVE07QUE4QmhCMkMsSUFBQUEsU0FBUyxFQUFFdkM7QUE5QkssR0FBRCxDQURQLENBQVY7QUFrQ0EsR0FBQztBQUFFeUIsSUFBQUE7QUFBRixNQUFVZSxLQUFLLENBQUNDLGdCQUFOLENBQXVCaEIsR0FBdkIsRUFBNEIsSUFBNUIsRUFBa0M7QUFDNUNBLElBQUFBLEdBQUcsRUFBRSxJQUR1QztBQUU1Q2lCLElBQUFBLE9BQU8sRUFBRSxLQUZtQztBQUc1Q0MsSUFBQUEsT0FBTyxFQUFFLENBQ1IsQ0FDQyxZQURELEVBRUM7QUFDQ0MsTUFBQUEsT0FBTyxFQUFFO0FBQ1JDLFFBQUFBLElBQUksRUFBRTtBQURFO0FBRFYsS0FGRCxDQURRO0FBSG1DLEdBQWxDLENBQVg7QUFjQSxTQUFPLHdCQUFTcEIsR0FBVCxFQUFjcUIsSUFBckI7QUFDQSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYmFieWxvbiBmcm9tICdAYmFiZWwvcGFyc2VyJztcbmltcG9ydCAqIGFzIGJhYmVsIGZyb20gJ0BiYWJlbC9jb3JlJztcbmltcG9ydCAqIGFzIHQgZnJvbSAnQGJhYmVsL3R5cGVzJztcbmltcG9ydCBnZW5lcmF0ZSBmcm9tICdAYmFiZWwvZ2VuZXJhdG9yJztcbmltcG9ydCBUZW1wbGF0ZSBmcm9tICdAYmFiZWwvdGVtcGxhdGUnO1xuXG5jb25zdCBtYW5pZmVzdFRlbXBsYXRlID0gVGVtcGxhdGUoYFxuXHRjb25zdCBJREVOVElUWSA9IHZhbHVlID0+IHZhbHVlO1xuXG5cdGNvbnN0IFBJQ0sgPSAodGFyZ2V0LCBrZXlzKSA9PlxuXHRcdGtleXMucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuXHRcdFx0YWNjW2tleV0gPSB0YXJnZXRba2V5XTtcblx0XHRcdHJldHVybiBhY2M7XG5cdFx0fSwge30pO1xuXG5cdG1vZHVsZS5leHBvcnRzID0gKHtcblx0XHRLRVlTID0gWydhc3NldElkJywgJ21vZHVsZUlkJywgJ3BpZCcsICd0eXBlJ10sXG5cdFx0RklMVEVSID0gREVGQVVMVF9GSUxURVIsXG5cdFx0QVNTRVRfTUFQID0ge31cblx0fSA9IHt9KSA9PiBNQU5JRkVTVDtcbmApO1xuXG5leHBvcnQgZGVmYXVsdCBtYW5pZmVzdCA9PiB7XG5cdGNvbnN0IHsgZGVwZW5kZW5jaWVzLCBtZXRhLCAuLi5vdGhlciB9ID0gbWFuaWZlc3QudG9KU09OKCk7XG5cdGNvbnN0IGtleXNJZGVudGlmaWVyID0gdC5JZGVudGlmaWVyKCdrZXlzJyk7XG5cdGNvbnN0IHBpY2tJZGVudGlmaWVyID0gdC5JZGVudGlmaWVyKCdwaWNrJyk7XG5cdGNvbnN0IGlkZW50aXR5SWRlbnRpZmllciA9IHQuSWRlbnRpZmllcignaWRlbnRpdHknKTtcblx0Y29uc3QgZmlsdGVySWRlbnRpZmllciA9IHQuSWRlbnRpZmllcignZGVwZW5kZW5jeUZpbHRlcicpO1xuXHRjb25zdCBhc3NldE1hcElkZW50aWZpZXIgPSB0LklkZW50aWZpZXIoJ2Fzc2V0TWFwJyk7XG5cblx0ZnVuY3Rpb24gYnVpbGRNZXRhT2JqZWN0RXhwcmVzc2lvbih2YWx1ZSkge1xuXHRcdGNvbnN0IG1ldGFPYmplY3RFeHByZXNzaW9uID0gYmFieWxvbi5wYXJzZUV4cHJlc3Npb24oSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcblx0XHRjb25zdCBhc3NldE1ldGFFeHByZXNzaW9uID0gdC5NZW1iZXJFeHByZXNzaW9uKFxuXHRcdFx0YXNzZXRNYXBJZGVudGlmaWVyLFxuXHRcdFx0dC5TdHJpbmdMaXRlcmFsKHZhbHVlLm91dHB1dFNsdWcpLFxuXHRcdFx0dHJ1ZVxuXHRcdCk7XG5cdFx0bWV0YU9iamVjdEV4cHJlc3Npb24ucHJvcGVydGllcy5wdXNoKFxuXHRcdFx0dC5PYmplY3RQcm9wZXJ0eShcblx0XHRcdFx0dC5TdHJpbmdMaXRlcmFsKCdhc3NldElkJyksXG5cdFx0XHRcdHQuQ29uZGl0aW9uYWxFeHByZXNzaW9uKFxuXHRcdFx0XHRcdGFzc2V0TWV0YUV4cHJlc3Npb24sXG5cdFx0XHRcdFx0dC5CaW5hcnlFeHByZXNzaW9uKCcrJywgdC5TdHJpbmdMaXRlcmFsKCd+LycpLCBhc3NldE1ldGFFeHByZXNzaW9uKSxcblx0XHRcdFx0XHR0LlN0cmluZ0xpdGVyYWwodmFsdWUubW9kdWxlSWQpXG5cdFx0XHRcdClcblx0XHRcdClcblx0XHQpO1xuXHRcdHJldHVybiBtZXRhT2JqZWN0RXhwcmVzc2lvbjtcblx0fVxuXG5cdGZ1bmN0aW9uIGJ1aWxkUGlja0V4cHJlc3Npb24odmFsdWUpIHtcblx0XHRyZXR1cm4gdC5DYWxsRXhwcmVzc2lvbihcblx0XHRcdHQuQ29uZGl0aW9uYWxFeHByZXNzaW9uKGtleXNJZGVudGlmaWVyLCBwaWNrSWRlbnRpZmllciwgaWRlbnRpdHlJZGVudGlmaWVyKSxcblx0XHRcdFt0LmlzSWRlbnRpZmllcih2YWx1ZSkgPyB2YWx1ZSA6IGJ1aWxkTWV0YU9iamVjdEV4cHJlc3Npb24odmFsdWUpLCBrZXlzSWRlbnRpZmllcl1cblx0XHQpO1xuXHR9XG5cblx0ZnVuY3Rpb24gYnVpbGREZXBlbmRlbmNpZXNDYWxsRXhwcmVzc2lvbihmaWx0ZXJOb2RlKSB7XG5cdFx0cmV0dXJuIHQuQ2FsbEV4cHJlc3Npb24oXG5cdFx0XHR0Lk1lbWJlckV4cHJlc3Npb24oXG5cdFx0XHRcdHQuQXJyYXlFeHByZXNzaW9uKGRlcGVuZGVuY2llcy5tYXAodmFsdWUgPT4gYnVpbGRNZXRhT2JqZWN0RXhwcmVzc2lvbih2YWx1ZSkpKSxcblx0XHRcdFx0dC5JZGVudGlmaWVyKCdmaWx0ZXInKVxuXHRcdFx0KSxcblx0XHRcdFtmaWx0ZXJOb2RlXVxuXHRcdCk7XG5cdH1cblxuXHRsZXQgYXN0ID0gdC5Qcm9ncmFtKFxuXHRcdG1hbmlmZXN0VGVtcGxhdGUoe1xuXHRcdFx0UElDSzogcGlja0lkZW50aWZpZXIsXG5cdFx0XHRJREVOVElUWTogaWRlbnRpdHlJZGVudGlmaWVyLFxuXHRcdFx0S0VZUzoga2V5c0lkZW50aWZpZXIsXG5cdFx0XHRGSUxURVI6IGZpbHRlcklkZW50aWZpZXIsXG5cdFx0XHRERUZBVUxUX0ZJTFRFUjogdC5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbihcblx0XHRcdFx0W3QuSWRlbnRpZmllcignbWV0YScpXSxcblx0XHRcdFx0dC5CaW5hcnlFeHByZXNzaW9uKCc9PT0nLCB0LklkZW50aWZpZXIoJ21ldGEudHlwZScpLCB0LlN0cmluZ0xpdGVyYWwobWV0YS50eXBlKSlcblx0XHRcdCksXG5cdFx0XHRNQU5JRkVTVDogdC5PYmplY3RFeHByZXNzaW9uKFtcblx0XHRcdFx0dC5PYmplY3RQcm9wZXJ0eSh0LlN0cmluZ0xpdGVyYWwoJ21ldGEnKSwgYnVpbGRQaWNrRXhwcmVzc2lvbihtZXRhKSksXG5cdFx0XHRcdC4uLk9iamVjdC5lbnRyaWVzKG90aGVyKS5tYXAoKFtrZXksIHZhbHVlXSkgPT5cblx0XHRcdFx0XHR0Lk9iamVjdFByb3BlcnR5KHQuU3RyaW5nTGl0ZXJhbChrZXkpLCBiYWJ5bG9uLnBhcnNlRXhwcmVzc2lvbihKU09OLnN0cmluZ2lmeSh2YWx1ZSkpKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHR0Lk9iamVjdFByb3BlcnR5KFxuXHRcdFx0XHRcdHQuU3RyaW5nTGl0ZXJhbCgnZGVwZW5kZW5jaWVzJyksXG5cdFx0XHRcdFx0dC5DYWxsRXhwcmVzc2lvbihcblx0XHRcdFx0XHRcdHQuTWVtYmVyRXhwcmVzc2lvbihcblx0XHRcdFx0XHRcdFx0YnVpbGREZXBlbmRlbmNpZXNDYWxsRXhwcmVzc2lvbihmaWx0ZXJJZGVudGlmaWVyKSxcblx0XHRcdFx0XHRcdFx0dC5JZGVudGlmaWVyKCdtYXAnKVxuXHRcdFx0XHRcdFx0KSxcblx0XHRcdFx0XHRcdFtcblx0XHRcdFx0XHRcdFx0dC5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbihcblx0XHRcdFx0XHRcdFx0XHRbdC5JZGVudGlmaWVyKCdtZXRhJyldLFxuXHRcdFx0XHRcdFx0XHRcdGJ1aWxkUGlja0V4cHJlc3Npb24odC5JZGVudGlmaWVyKCdtZXRhJykpXG5cdFx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHQpXG5cdFx0XHRcdClcblx0XHRcdF0pLFxuXHRcdFx0QVNTRVRfTUFQOiBhc3NldE1hcElkZW50aWZpZXJcblx0XHR9KVxuXHQpO1xuXHQoeyBhc3QgfSA9IGJhYmVsLnRyYW5zZm9ybUZyb21Bc3QoYXN0LCBudWxsLCB7XG5cdFx0YXN0OiB0cnVlLFxuXHRcdGJhYmVscmM6IGZhbHNlLFxuXHRcdHByZXNldHM6IFtcblx0XHRcdFtcblx0XHRcdFx0J0BiYWJlbC9lbnYnLFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGFyZ2V0czoge1xuXHRcdFx0XHRcdFx0bm9kZTogJ2N1cnJlbnQnXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRdXG5cdFx0XVxuXHR9KSk7XG5cdHJldHVybiBnZW5lcmF0ZShhc3QpLmNvZGU7XG59O1xuIl19
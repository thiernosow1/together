"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = asyncify;

var _last = _interopRequireDefault(require("./last"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Wraps a function with signature {@code (...args, callback)}
 * {@br}
 * {@bold Note:} This is not the same as [promisify]{@link module:promisify}
 * @since 0.1.0
 *
 * @param {function} fn - The function to wrap
 * @param {object} [context] - The function context
 * @return {function}
 *
 * @example
 * // before
 * compiler.plugin('emit', (asset, cb) => {
 * 	doSomethingAsync()
 * 		.then(result => cb(null, result))
 * 		.catch(err => cb(err));
 * });
 *
 * // after
 * compiler.plugin('emit', asyncify(asset => {
 * 	return doSomethingAsync();
 * }));
 */
function asyncify(fn, context) {
  return (...args) => {
    const cb = (0, _last.default)(args);
    const other = args.slice(0, -1);
    return Promise.resolve().then(() => fn.call(context, ...other)).then(result => cb(null, result)).catch(err => cb(err));
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvaGVscGVycy9hc3luY2lmeS5qcyJdLCJuYW1lcyI6WyJhc3luY2lmeSIsImZuIiwiY29udGV4dCIsImFyZ3MiLCJjYiIsIm90aGVyIiwic2xpY2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInRoZW4iLCJjYWxsIiwicmVzdWx0IiwiY2F0Y2giLCJlcnIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVCZSxTQUFTQSxRQUFULENBQWtCQyxFQUFsQixFQUFzQkMsT0FBdEIsRUFBK0I7QUFDN0MsU0FBTyxDQUFDLEdBQUdDLElBQUosS0FBYTtBQUNuQixVQUFNQyxFQUFFLEdBQUcsbUJBQUtELElBQUwsQ0FBWDtBQUNBLFVBQU1FLEtBQUssR0FBR0YsSUFBSSxDQUFDRyxLQUFMLENBQVcsQ0FBWCxFQUFjLENBQUMsQ0FBZixDQUFkO0FBQ0EsV0FBT0MsT0FBTyxDQUFDQyxPQUFSLEdBQ0xDLElBREssQ0FDQSxNQUFNUixFQUFFLENBQUNTLElBQUgsQ0FBUVIsT0FBUixFQUFpQixHQUFHRyxLQUFwQixDQUROLEVBRUxJLElBRkssQ0FFQUUsTUFBTSxJQUFJUCxFQUFFLENBQUMsSUFBRCxFQUFPTyxNQUFQLENBRlosRUFHTEMsS0FISyxDQUdDQyxHQUFHLElBQUlULEVBQUUsQ0FBQ1MsR0FBRCxDQUhWLENBQVA7QUFJQSxHQVBEO0FBUUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbGFzdCBmcm9tICcuL2xhc3QnO1xuXG4vKipcbiAqIFdyYXBzIGEgZnVuY3Rpb24gd2l0aCBzaWduYXR1cmUge0Bjb2RlICguLi5hcmdzLCBjYWxsYmFjayl9XG4gKiB7QGJyfVxuICoge0Bib2xkIE5vdGU6fSBUaGlzIGlzIG5vdCB0aGUgc2FtZSBhcyBbcHJvbWlzaWZ5XXtAbGluayBtb2R1bGU6cHJvbWlzaWZ5fVxuICogQHNpbmNlIDAuMS4wXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gLSBUaGUgZnVuY3Rpb24gdG8gd3JhcFxuICogQHBhcmFtIHtvYmplY3R9IFtjb250ZXh0XSAtIFRoZSBmdW5jdGlvbiBjb250ZXh0XG4gKiBAcmV0dXJuIHtmdW5jdGlvbn1cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gYmVmb3JlXG4gKiBjb21waWxlci5wbHVnaW4oJ2VtaXQnLCAoYXNzZXQsIGNiKSA9PiB7XG4gKiBcdGRvU29tZXRoaW5nQXN5bmMoKVxuICogXHRcdC50aGVuKHJlc3VsdCA9PiBjYihudWxsLCByZXN1bHQpKVxuICogXHRcdC5jYXRjaChlcnIgPT4gY2IoZXJyKSk7XG4gKiB9KTtcbiAqXG4gKiAvLyBhZnRlclxuICogY29tcGlsZXIucGx1Z2luKCdlbWl0JywgYXN5bmNpZnkoYXNzZXQgPT4ge1xuICogXHRyZXR1cm4gZG9Tb21ldGhpbmdBc3luYygpO1xuICogfSkpO1xuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBhc3luY2lmeShmbiwgY29udGV4dCkge1xuXHRyZXR1cm4gKC4uLmFyZ3MpID0+IHtcblx0XHRjb25zdCBjYiA9IGxhc3QoYXJncyk7XG5cdFx0Y29uc3Qgb3RoZXIgPSBhcmdzLnNsaWNlKDAsIC0xKTtcblx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKClcblx0XHRcdC50aGVuKCgpID0+IGZuLmNhbGwoY29udGV4dCwgLi4ub3RoZXIpKVxuXHRcdFx0LnRoZW4ocmVzdWx0ID0+IGNiKG51bGwsIHJlc3VsdCkpXG5cdFx0XHQuY2F0Y2goZXJyID0+IGNiKGVycikpO1xuXHR9O1xufVxuIl19
{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/together/together/client/src/components/defi.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport '../assets/css/app.css';\nimport firebase from 'firebase';\nimport { db, auth, storage } from \"../firebase/config\";\nimport Color from \"../assets/js/dev/classes/color\";\nexport default class Defi extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isSignedIn: true,\n      challenges: [],\n      page: \"dessin\",\n      posts: []\n    };\n  }\n\n  componentDidMount() {\n    const MILLISECOND = 86400000; //5184000000; // correspondance d'une heure en milliseconde\n\n    db.collection(\"challenges\").get().then(snapshot => {\n      const challenges = [];\n      snapshot.docs.forEach(doc => {\n        let data = doc.data();\n        data.id = doc.id;\n        challenges.push(data);\n      });\n      this.setState({\n        challenges\n      });\n    }).catch(error => console.log(error));\n    let posts = [];\n    db.collection(\"posts\").get().then(snapshot => {\n      snapshot.docs.forEach(doc => {\n        let post = doc.data();\n        post.id = doc.ref.id;\n\n        if (post.author) {\n          post.author.get().then(res => {\n            post.author = res.data();\n            post.author.id = res.id;\n          }).catch(error => console.log(error));\n        }\n\n        if (post.challenge_ref) {\n          post.challenge_ref.get().then(res => {\n            post.challenge_ref = res.data();\n            post.challenge_ref.id = res.id;\n            post.challenge_ref.duration = post.challenge_ref.duration * MILLISECOND;\n          }).catch(error => console.log(error));\n        }\n\n        posts.push(post);\n      });\n      console.log(posts);\n    }).then(() => this.setState({\n      posts\n    })).catch(error => console.log(error));\n  }\n\n  displayChallenges(challenges) {\n    return challenges.map(challenge => {\n      const time = -challenge.duration + (Date.now() - challenge.created_at);\n      const date = new Date(time); // temps écoulé\n\n      console.log(time);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"defi\",\n        key: challenge.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }\n      }, challenge.description), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }\n      }, challenge.type, \" -\", \" \", new Date(challenge.created_at).toLocaleString()), /*#__PURE__*/React.createElement(\"div\", {\n        class: \"time\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        alt: \"clock\",\n        src: \"/prod/clock.svg\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 13\n        }\n      }, date.toLocaleTimeString(), \" \\xE9coul\\xE9\")));\n    });\n  } // Fonctionnalité like\n\n\n  isLiked(post) {\n    const userId = localStorage.getItem(\"userId\");\n    const elmt = post.likes.findIndex(like => like.isEqual(db.doc(`users/${userId}`)));\n    console.log(elmt);\n    return elmt !== -1;\n  } // Affichage du classement\n\n\n  classement(posts) {\n    return posts.map(post => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"displayPosts\",\n      key: post.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }\n    }, \"auteur: \", post.author.user, \" \"), /*#__PURE__*/React.createElement(\"img\", {\n      className: \"imageForm\",\n      src: post.picture_url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"likes\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, this.isLiked(post) ? /*#__PURE__*/React.createElement(\"img\", {\n      id: post.id,\n      className: \"imgLike\",\n      src: \"/heart_full.svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 13\n      }\n    }) : /*#__PURE__*/React.createElement(\"img\", {\n      id: post.id,\n      className: \"imgLike\",\n      src: \"/heart.svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }\n    }, post.likes.length)), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }\n    }, post.challenge_ref.description), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }\n    }, post.challenge_ref.duration, \" \")));\n  }\n\n  manageContent() {\n    const {\n      page,\n      challenges,\n      posts\n    } = this.state;\n\n    if (page == \"dessin\") {\n      const dessins = challenges.filter(challenge => challenge.type == \"DESSIN\");\n      return (dessins === null || dessins === void 0 ? void 0 : dessins.length) !== 0 ? this.displayChallenges(dessins) : /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 9\n        }\n      }, \" Pas de d\\xE9fis propos\\xE9s \");\n    } else if (page == \"photo\") {\n      const photos = challenges.filter(challenge => challenge.type == \"PHOTO\");\n      return (photos === null || photos === void 0 ? void 0 : photos.length) !== 0 ? this.displayChallenges(photos) : /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 9\n        }\n      }, \" Pas de d\\xE9fis propos\\xE9s \");\n    } else {\n      return (posts === null || posts === void 0 ? void 0 : posts.length) !== 0 ? this.classement(posts.sort((post1, post2) => post2.likes.length - post1.likes.length)) : /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 9\n        }\n      }, \" Pas de classement disponible\");\n    }\n  }\n\n  render() {\n    const {\n      challenges\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      class: \"home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/profil\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"profil picture\",\n      class: \"avatar\",\n      src: \"/logout/avatar.svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/login\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => firebase.auth().signOut(),\n      class: \"logout\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"en-tete\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }\n    }, \"D\\xE9fis\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sousmenu\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      onClick: () => this.setState({\n        page: \"dessin\"\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 11\n      }\n    }, \"Dessin\"), /*#__PURE__*/React.createElement(\"a\", {\n      onClick: () => this.setState({\n        page: \"photo\"\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }\n    }, \"Photo\"), /*#__PURE__*/React.createElement(\"a\", {\n      onClick: () => this.setState({\n        page: \"classement\"\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 11\n      }\n    }, \"Classement\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"main-page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }\n    }, this.manageContent()), /*#__PURE__*/React.createElement(\"nav\", {\n      class: \"nav_menu\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"img1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/post\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"img2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/subscription\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"img3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/defi\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"img4_b\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}","map":{"version":3,"sources":["/Applications/MAMP/htdocs/together/together/client/src/components/defi.js"],"names":["React","Component","Link","firebase","db","auth","storage","Color","Defi","state","isSignedIn","challenges","page","posts","componentDidMount","MILLISECOND","collection","get","then","snapshot","docs","forEach","doc","data","id","push","setState","catch","error","console","log","post","ref","author","res","challenge_ref","duration","displayChallenges","map","challenge","time","Date","now","created_at","date","description","type","toLocaleString","toLocaleTimeString","isLiked","userId","localStorage","getItem","elmt","likes","findIndex","like","isEqual","classement","user","picture_url","length","manageContent","dessins","filter","photos","sort","post1","post2","render","signOut"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {Link} from 'react-router-dom';\nimport '../assets/css/app.css';\nimport firebase from 'firebase';\nimport  {db,auth,storage} from \"../firebase/config\";\nimport Color from \"../assets/js/dev/classes/color\";\n\nexport default class Defi extends Component {\n  state = {\n    isSignedIn: true,\n    challenges: [],\n    page: \"dessin\",\n    posts: [],\n  };\n  componentDidMount() {\n    const MILLISECOND = 86400000; //5184000000; // correspondance d'une heure en milliseconde\n    db.collection(\"challenges\")\n      .get()\n      .then((snapshot) => {\n        const challenges = [];\n        snapshot.docs.forEach((doc) => {\n          let data = doc.data();\n          data.id = doc.id;\n          challenges.push(data);\n        });\n        this.setState({ challenges });\n      })\n      .catch((error) => console.log(error));\n\n    let posts = [];\n    db.collection(\"posts\")\n      .get()\n      .then((snapshot) => {\n        snapshot.docs.forEach((doc) => {\n          let post = doc.data();\n          post.id = doc.ref.id;\n          if (post.author) {\n            post.author\n              .get()\n              .then((res) => {\n                post.author = res.data();\n                post.author.id = res.id;\n              })\n              .catch((error) => console.log(error));\n          }\n          if (post.challenge_ref) {\n            post.challenge_ref\n              .get()\n              .then((res) => {\n                post.challenge_ref = res.data();\n                post.challenge_ref.id = res.id;\n                post.challenge_ref.duration =\n                  post.challenge_ref.duration * MILLISECOND;\n              })\n              .catch((error) => console.log(error));\n          }\n          posts.push(post);\n        });\n        console.log(posts);\n      })\n      .then(() => this.setState({ posts }))\n      .catch((error) => console.log(error));\n  }\n\n  displayChallenges(challenges) {\n    return challenges.map((challenge) => {\n      const time = -challenge.duration + (Date.now() - challenge.created_at);\n      const date = new Date(time); // temps écoulé\n      console.log(time);\n      return (\n        <div className=\"defi\" key={challenge.id}>\n          <h4>{challenge.description}</h4>\n          <p>\n            {challenge.type} -{\" \"}\n            {new Date(challenge.created_at).toLocaleString()}\n          </p>\n          <div class=\"time\">\n            <img alt=\"clock\" src=\"/prod/clock.svg\" />\n            <p>{date.toLocaleTimeString()} écoulé</p>\n          </div>\n        </div>\n      );\n    });\n  }\n\n  // Fonctionnalité like\n  isLiked(post) {\n    const userId = localStorage.getItem(\"userId\");\n    const elmt = post.likes.findIndex((like) =>\n      like.isEqual(db.doc(`users/${userId}`))\n    );\n    console.log(elmt);\n    return elmt !== -1;\n  }\n\n  // Affichage du classement\n  classement(posts) {\n    return posts.map((post) => (\n      <div className=\"displayPosts\" key={post.id}>\n        <p>auteur: {post.author.user} </p>\n        <img className=\"imageForm\" src={post.picture_url} />\n        <div className=\"likes\">\n          {this.isLiked(post) ? (\n            <img id={post.id} className=\"imgLike\" src=\"/heart_full.svg\" />\n          ) : (\n            <img id={post.id} className=\"imgLike\" src=\"/heart.svg\" />\n          )}\n          <p>{post.likes.length}</p>\n        </div>\n        <p>{post.challenge_ref.description}</p>\n        <p>{post.challenge_ref.duration} </p>\n      </div>\n    ));\n  }\n\n  manageContent() {\n    const { page, challenges, posts } = this.state;\n    if (page == \"dessin\") {\n      const dessins = challenges.filter(\n        (challenge) => challenge.type == \"DESSIN\"\n      );\n      return dessins?.length !== 0 ? (\n        this.displayChallenges(dessins)\n      ) : (\n        <p> Pas de défis proposés </p>\n      );\n    } else if (page == \"photo\") {\n      const photos = challenges.filter(\n        (challenge) => challenge.type == \"PHOTO\"\n      );\n      return photos?.length !== 0 ? (\n        this.displayChallenges(photos)\n      ) : (\n        <p> Pas de défis proposés </p>\n      );\n    } else {\n      return posts?.length !== 0 ? (\n        this.classement(\n          posts.sort((post1, post2) => post2.likes.length - post1.likes.length)\n        )\n      ) : (\n        <p> Pas de classement disponible</p>\n      );\n    }\n  }\n\n  render() {\n    const { challenges } = this.state;\n    return (\n      <div class=\"home\">\n        <div class=\"header\">\n          <Link to=\"/profil\">\n            <img alt=\"profil picture\" class=\"avatar\" src=\"/logout/avatar.svg\" />\n          </Link>\n          <Link to=\"/login\">\n            <button\n              onClick={() => firebase.auth().signOut()}\n              class=\"logout\"\n            ></button>\n          </Link>\n        </div>\n        <div class=\"en-tete\">\n          <h2>Défis</h2>\n        </div>\n        <div className=\"sousmenu\">\n          <a onClick={() => this.setState({ page: \"dessin\" })}>Dessin</a>\n          <a onClick={() => this.setState({ page: \"photo\" })}>Photo</a>\n          <a onClick={() => this.setState({ page: \"classement\" })}>Classement</a>\n        </div>\n\n        <div class=\"main-page\">{this.manageContent()}</div>\n\n        <nav class=\"nav_menu\">\n          <Link to=\"/home\">\n            <div class=\"img1\"></div>\n          </Link>\n          <Link to=\"/post\">\n            <div class=\"img2\"></div>\n          </Link>\n          <Link to=\"/subscription\">\n            <div class=\"img3\"></div>\n          </Link>\n          <Link to=\"/defi\">\n            <div class=\"img4_b\"></div>\n          </Link>\n        </nav>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}